<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>LAPAM</title>
        <!-- Bootstrap Core CSS -->
        <link href="../styles/bootstrap.min.css" rel="stylesheet">
        <!-- Custom CSS -->
        <link href="../styles/landing-page.css" rel="stylesheet">
        <!-- Custom Fonts -->
        <link href="../styles/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <!-- jQuery -->
		<link rel="stylesheet" href="../styles/googleapis.css">
		<link rel="stylesheet" href="../styles/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="../styles/bootstrap.min.css">
		<script src="../JScript/jquery.min.js"></script>
		<script src="../JScript/bootstrap.min.js"></script>
        <script src="../JScript/Lapam.js"></script>
        <style>
		
@font-face {
	font-family: 'AccentureRotis';
	src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}
	
	body {
		font-family: AccentureRotis;
	 }
		
		
.p-2 {
    padding: .5rem!important;
}
@media (min-width: 768px)
.container {
    max-width: 520px;
}
@media (min-width: 576px)
.container {
    max-width: 540px;
}
.container {
    width: 100%;
    padding-right: 15px;
    padding-left: 15px;
    margin-right: auto;
    margin-left: auto;
}
*, ::after, ::before {
    box-sizing: border-box;
}

		.bar {
			height: 40px;
			border-left: 3px solid #000000;
		}
		.p-1 {
			padding: .25rem!important;
		}
				.mt-2, .my-2 {
			margin-top: .5rem!important;
		}
		.header-logo
		{
			width: 120px;
			font-size: 1rem;
		}
		.ttp-title {
			font-family: "AccentureRotis",Helvetica,Arial,sans-serif;
			vertical-align: middle;
			flex-grow: 1;
			align-items: center;
			margin: 0;
		}
		.pat-text {
			font-size: 0.7rem;
			padding-left: 5px;			
		}
		.ml-auto, .mx-auto {
			margin-left: auto!important;
		}
		.mr-auto, .mx-auto {
			margin-right: auto!important;
		}
		.m-0 {
			margin: 0!important;
		}
            .accLogo {
            margin-top: 10px;
            float: right;
            margin-right: 0px;
            width: 140px;
            }
            .TTLMHeader {
            background: #000;
            float: left;
            width: 100%;
            display:block;
            }
            .TTLMHeader h2 {
            color: #fff;
            width: 60%;
            float: left;
            margin: 5px 10px 5px 10px;
            font-size: 26px;
            font-weight: normal;
            display:block;
            }
            .TTLMHeader p {
            color: wheat;
            float: left;
            width: 60%;
            margin: 0px 10px 0px 15px;
            font-size: 12px;
            display:block;
            }
            #Img_logo {
            cursor: pointer;
            width: 5%;
            margin-top: 5px;
            margin-left: 5px;
            float: left;
            }
            .NewQual
            {
            margin-left: 20%;
            margin-top: 50px;
            margin-bottom: 24%;
            display: none;
            }
            .upload_lbl{margin-right: 20px; margin-bottom: 20px; width: 200px;}
			
			.ontop {
				z-index: 999;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
				position: absolute;
				background-color: #cccccc;
				color: #aaaaaa;
				opacity: .4;
				filter: alpha(opacity=70);
			}
			.fieldset-checkbox
			{
			  border-radius:25px;
			  height:auto; 
			  width:750px;
			  border:solid;
			}
			.fs_legend
			{
			  margin-left: 25px;
			  font-size: 16px;
			  width: 120px;
			  border-bottom: none;
			}
			body {
        color: #404E67;
        background: #F5F7FA;
		font-family: 'AccentureRotis', sans-serif;
	}
	.table-wrapper {
		width: 600px;
		height: 400px;
		margin: 30px auto;
        background: #fff;
        padding: 20px;	
        box-shadow: 0 1px 1px rgba(0,0,0,.05);
    }
    .table-title {
        padding-bottom: 10px;
        margin: 0 0 10px;
    }
    .table-title h2 {
        margin: 6px 0 0;
        font-size: 22px;
    }
    .table-title .add-new {
        float: right;
		height: 30px;
		font-weight: bold;
		font-size: 12px;
		text-shadow: none;
		min-width: 150px;
		border-radius: 50px;
		line-height: 13px;
    }
	.table-title .add-new i {
		margin-right: 4px;
	}
    table.table {
        table-layout: fixed;
    }
    table.table tr th, table.table tr td {
        border-color: #e9e9e9;
    }
	table.table tr th { 
		background-color: darkseagreen;
	}	
	table.table tr td {
        font-weight: normal;
    }
    table.table th i {
        font-size: 13px;
        margin: 0 5px;
        cursor: pointer;
    }
    table.table th:last-child {
        width: 100px;
    }
    table.table td a {
		cursor: pointer;
        display: inline-block;
        margin: 0 5px;
		min-width: 24px;
    }    
	table.table td a.add {
        color: #27C46B;
    }
    table.table td a.edit {
        color: #FFC107;
    }
    table.table td a.delete {
        color: #E34724;
    }
    table.table td a.cancel {
        color: #A4A4A4;
    }
    table.table td i {
        font-size: 19px;
    }
	table.table td a.add i {
        font-size: 24px;
    	margin-right: -1px;
        position: relative;
        top: 3px;
    }    
    table.table .form-control {
        height: 32px;
        line-height: 32px;
        box-shadow: none;
        border-radius: 2px;
		font-size: 11px;
    }
	table.table .form-control.error {
		border-color: #f50000;
	}
	table.table td .add, table.table td .cancel {
		display: none;
	}
	table.table td.first { display: none; }
	table.table th.first { display: none; }
	.table > caption + thead > tr:first-child > th,
	.table > colgroup + thead > tr:first-child > th,
	.table > thead:first-child > tr:first-child > th,
	.table > caption + thead > tr:first-child > td,
	.table > colgroup + thead > tr:first-child > td,
	.table > thead:first-child > tr:first-child > td {
	  border-top: 0;
	  background-color: darkseagreen;
	}
        </style>
		<script type="text/javascript">
			$(document).ready(function(){
				$('[data-toggle="tooltip"]').tooltip();
				var actions = $("table td:last-child").html();
				var isNew = false;
				// Append table with add row form on add new button click
				$(".add-new").click(function(){
					isNew = true;
					$(this).attr("disabled", "disabled");
					var actions = "<a class=\"add\" title=\"Add\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xE03B;</i></a><a class=\"cancel\" title=\"Cancel\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xe5c9;</i></a><a class=\"edit\" title=\"Edit\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xE254;</i></a><a class=\"delete\" title=\"Delete\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xE872;</i></a>"
					var index = $("table tbody tr:last-child").index();
					var col_len = $("table thead tr th").length;
					var row = '<tr>';
					var col_i=0;
					for (row_i = 0; row_i < col_len; row_i = row_i + 1) {
						if(row_i != (col_len - 1))
						{
							if($("table thead tr th").eq(col_i).text().toLowerCase() == "status")
							{
								row += '<td><select id="status" class="form-control" style="width: 80px;"><option value="Active">Active</option><option value="InActive">InActive</option></select></td>';
							}
							else{
								row += '<td><input type="text" class="form-control"></td>';								
							}
						}
						else{
							row += '<td>'+actions+'</td>';
						}
						col_i++;
						/*'<td><input type="text" class="form-control" name="username" id="username" maxlength="20" pattern="^[a-zA-Z0-9_.]+$"></td>' +
						'<td><input type="text" class="form-control" name="Password" id="Password" maxlength="8"></td>' +
						'<td><select id="status" class="form-control" style="width: 80px;"><option value="Active">Active</option><option value="InActive">InActive</option></select></td>' +
						'<td>' + actions + '</td>' +*/
					}
					row += '</tr>';
					$("table").append(row);
					$("table tbody tr").eq(index + 1).find(".add, .edit").toggle(); 
					$("table tbody tr").eq(index + 1).find(".cancel, .delete").toggle();
					$('[data-toggle="tooltip"]').tooltip();
				});
				
				// Add row on add button click
				$(document).on("click", ".add", function(){
					var empty = false;
					var addcol_i = 0;
					var first_val;
					var header_result=[];
					var input = $(this).parents("tr").find('input[type="text"]');
					var td_val = $(this).parents("tr").find('td');
					var table_length = $("table > tbody > tr:first > td").length;
					td_val.each(function(index){
						if((table_length - 1) != index)
						{
							header_result.push($("table thead tr th").eq(index).text());
						}
					});
					input.each(function(){
						if(!$(this).val()){
							$(this).addClass("error");
							empty = true;
						} 
						else{				
							$(this).removeClass("error");
						}
					});
					$(this).parents("tr").find(".error").first().focus();
					var select = $(this).parents("tr").find('select');
					if(!empty){
						var result = [];
						var xhttp = new XMLHttpRequest();
						var fd = new FormData();
						if(isNew)
						{	
							input.each(function(index){
								$(this).parent("td").html($(this).val());
								var curr_val = $(this).val();
								curr_val = curr_val.replace(/,/g,"~");
								result.push(escapeHtml(curr_val));								//result.push($(this).val());
							});
							select.each(function(index){
								$(this).parent("td").html($(this).val());
								if($(this).val() == "Active")
								{
									result.push("1");	
								}
								else
								{
									result.push("0");	
								}
							});
							fd.append("row_list", result);
							fd.append("header_list", header_result);
							if(localStorage.getItem("tablename").toLowerCase() == "mapping" || localStorage.getItem("tablename").toLowerCase() == "log_info" || localStorage.getItem("tablename").toLowerCase() == "report_imperatives" )
							{
								fd.append("isIDCheck","false");
							}
							else{
								fd.append("isIDCheck","true");
							}
							
							fd.append("tablename",localStorage.getItem("tablename"));
							xhttp.open("POST", "../../cgi-bin/insertrow.py", true);
							xhttp.send(fd);
							xhttp.onreadystatechange = function() {
								if (this.readyState == 4 && this.status == 200) {
									if(this.responseText.trim().toString() == "FAP 1")
									{
										alert("Data already exists");
										if(isNew)
										{
											$(this).parents("tr").remove();
											$(".add-new").removeAttr("disabled");
										}										
									}
									else
									{
										alert("Data added successfully");							
									}
									isNew = false;
								}
							};
						}
						else{
							input.each(function(){
								$(this).parent("td").html($(this).val());
								var curr_val = $(this).val();
								curr_val = curr_val.replace(/,/g,"~");
								result.push(escapeHtml(curr_val)); //result.push($(this).val());
							});
							select.each(function(){
								$(this).parent("td").html($(this).val());
								//result.push($(this).val());
								
								if($(this).val() == "Active")
								{
									result.push("1");	
								}
								else
								{
									result.push("0");	
								}
							});
							//fd.append("user_list", result);
							fd.append("row_list", result);
							fd.append("header_list", header_result);
							fd.append("tablename",localStorage.getItem("tablename"));
							xhttp.open("POST", "../../cgi-bin/updaterow.py", true);
							xhttp.send(fd);
							xhttp.onreadystatechange = function() {
								if (this.readyState == 4 && this.status == 200) {
									if(this.responseText.trim().toString() == "FAP 1")
									{
										alert("Data already exists");
										if(isNew)
										{
											$(this).parents("tr").remove();
											$(".add-new").removeAttr("disabled");
										}
									}
									else
									{
										alert("Data added successfully");							
									}
								}
							};
						}			
						$(this).parents("tr").find(".add, .edit").toggle();
						$(this).parents("tr").find(".cancel, .delete").toggle();
						$(".add-new").removeAttr("disabled");
					}		
				});
				// Edit row on edit button click
				$(document).on("click", ".edit", function(){
					var col_i=0;
					$(this).parents("tr").find("td:not(:last-child)").each(function(){
						if($("table thead tr th").eq(col_i).text().toLowerCase() == "status")
						{
							if($(this).text() == "Active")
							{
							$(this).html('<select id="status" class="form-control" style="width: 80px;"><option value="Active" selected>Active</option><option value="InActive">InActive</option></select>');
							}
							else if($(this).text() == "InActive")
							{
							$(this).html('<select id="status" class="form-control" style="width: 80px;"><option value="Active" >Active</option><option value="InActive"selected>InActive</option></select>');
							}
						}
						else{
							$(this).html('<input type="text" class="form-control" value="' + $(this).text() + '">');
						}
						col_i++;
						//$(this).html('<input type="text" class="form-control" value="' + $(this).text() + '">');
					});	
					$(".add-new").attr("disabled", "disabled");			
					$(this).parents("tr").find(".add, .edit").toggle();
					$(this).parents("tr").find(".cancel, .delete").toggle();
				});
				// Cancel row on cancel button click
				$(document).on("click", ".cancel", function(){	        		
					var input = $(this).parents("tr").find('input[type="text"]');
					var select = $(this).parents("tr").find('select');
					
					if(isNew)
					{
						$(this).parents("tr").remove();
					}
					else{
						input.each(function(){
							$(this).parent("td").html($(this).val());
						});
						select.each(function(){
							$(this).parent("td").html($(this).val());
						});	
					}
					$(".add-new").removeAttr("disabled");					
					$(this).parents("tr").find(".add, .edit").toggle();
					$(this).parents("tr").find(".cancel, .delete").toggle();
				});
				// Delete row on delete button click
				$(document).on("click", ".delete", function(){		
					var id_val = $(this).parents("tr").find('td:eq(0)').html();
					$(this).parents("tr").remove();
					$(".add-new").removeAttr("disabled");
					var xhttp = new XMLHttpRequest();
					var fd = new FormData();
					fd.append("id_val", id_val);
					fd.append("fieldname", $("table thead tr th").eq(0).text());
					fd.append("tablename",localStorage.getItem("tablename"));
					xhttp.open("POST", "../../cgi-bin/deleterow.py", true);
					xhttp.send(fd);
					xhttp.onreadystatechange = function() {
						if (this.readyState == 4 && this.status == 200) {
							alert("Data deleted successfully");
						}
					};
				});	
				
			});
			
			var tcodevalue = "";
			function fetchdata(htmlpage, online_data)
			{
				var resvalue = 0;
				var isOnline = false;
				document.getElementById("div_adminpage").style.display = "block";
				localStorage.setItem("tablename",htmlpage);
				$("#div_hdr h2 b").text("Business Flow Configurator");
				var xhttp = new XMLHttpRequest();
				var fd = new FormData(this.responseText);	
				fd.append("tablename",htmlpage);
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						$(this).attr("disabled", "disabled");
						var index = $("table tbody tr:last-child").index();
						var str = this.responseText;
						//$('table tr').slice(0).remove();
						var actions = "<a class=\"add\" title=\"Add\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xE03B;</i></a><a class=\"cancel\" title=\"Cancel\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xe5c9;</i></a><a class=\"edit\" title=\"Edit\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xE254;</i></a><a class=\"delete\" title=\"Delete\" data-toggle=\"tooltip\"><i class=\"material-icons\">&#xE872;</i></a>"
						$("table tbody tr").remove();	
						$("table tr").remove();	
						$("table thead").remove();			
						var rows = str.split("\n");
						var row_count = 1;
						for (row_i = 1; row_i < rows.length - 1; row_i = row_i + 1) {
							var val_arr = rows[row_i].split("`");
							var row = '';
							if(row_i == 1)
							{
								row = '<thead><tr>';
							}
							else
							{
								row = '<tr>';
							}
							var col_i=0;
							for(val_i = 1; val_i < val_arr.length; val_i=val_i+2)
							{
								if(row_i == 1)
								{
									if(col_i > 0)
									{
										if(val_arr[val_i] == "ResponseTime")
										{
											row += '<th>Response time(Seconds)</th>';
										}
										else{
										row += '<th>'+val_arr[val_i].replace(/[\[\]\(\)'`]/g, ''); + '</th>';
										}
									}
								}
								else{
									if(col_i > 0)
									{
										var bfc_drp = document.getElementById("bfc_drp");
										selected_value = bfc_drp.options[bfc_drp.selectedIndex].text;
										
										if((val_arr[1].replace(/[\[\]\(\)'`]/g, '')).toString() == selected_value)
										{
											if(col_i == 1)
											{
												//row += '<td style="width: 200px;"><a href="javascript:serviceCallUsage();" style="text-decoration: underline;">'+escapeHtml(val_arr[val_i]) + '</a></td>';
												row += '<td style="width: 200px;">'+escapeHtml(val_arr[val_i]) + '</td>';
											}
											else{
												row += '<td style="width: 200px;">'+escapeHtml(val_arr[val_i].replace(/[\[\]\(\)'`]/g, '')) + '</td>';
												var tcodevalue = parseFloat(escapeHtml(val_arr[val_i]));                                                
                                                if (!isNaN(tcodevalue))
												{
													 resvalue+= tcodevalue;                                                       
												} 
											}
											
										}
									}
								}
								document.getElementById('lblName').innerHTML = resvalue.toFixed(2);
								col_i++;
							}
							/*else{
								if(row_i == 1)
								{
									row += '<th style="width: 100px;">Actions</th></tr></thead>';
								}
								else
								{
									row += '<td>'+actions+'</td></tr>';
								}
							}*/
							$("table").append(row);
							$(".add-new").removeAttr("disabled");
							$('[data-toggle="tooltip"]').tooltip(); 
						}						
						$('#dummyrow').remove(); 
					}
				};
				xhttp.open("POST", "../cgi-bin/fetchdata.py", true);
				xhttp.send(fd);
			}
			
			var date_list = [];
			
			function disableAdminDiv()
			{
				document.getElementById("div_adminpage").style.display = "none";
				var xhttp = new XMLHttpRequest();
				var fd = new FormData();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						var ext_response_arr = this.responseText.toString().split("'");
						for (time_i=1;time_i<ext_response_arr.length-1;time_i=time_i+2)
						{
							var option = document.createElement("option");
							option.text = ext_response_arr[time_i];
							bfc_drp.add(option, ext_response_arr[time_i]);
						}
						fetchdata('bfc', '0');
					}
				};
				xhttp.open("POST", "../cgi-bin/getbfnameList.py", true);
				xhttp.send(fd);
			}
			
			var entityMap = {
				  '&': '&amp;',
				  '<': '&lt;',
				  '>': '&gt;',
				  '"': '&quot;',
				  "'": '&#39;',
				  '/': '&#x2F;',
				  '\\': '&#x5c;',
				  '`': '&#x60;',
				  '=': '&#x3D;'
				};
			
			// Escape html string characters
			function escapeHtml (string) {
			  return String(string).replace(/[&<>"'`=\/]/g, function (s) {
				return entityMap[s];
			  });
			  
			  
			}
			function goBack(){
				window.location.href = "IMP020.html";
			}

			//funtion to retrieve the data for particular Service Call
			function serviceCallUsage()
			{
				window.location.href = "IMP019.html";
			}
			</script>
    </head>
    <body onload="disableAdminDiv()">
		<div id="div_adminpage" style="height: 78%;">
			<div class="container">
				<div class="table-wrapper">
					<div class="table-title">
						<div class="row">
							<div class="col-sm-8" id="div_hdr" style="font-family:AccentureRotis;width: 100%"><h2 ><b></b></h2> <button onclick="goBack()" style="float: right; margin-right: 10px; margin-top: -20px;">Back</button></div><br/><br/>
							<div class="col-sm-8" id="div_drp">Business Flow Name: <select id="bfc_drp" onchange="fetchdata('bfc','0')" style="font-family:AccentureRotis; margin-left: 10px; width: 200px;"><select/><h2 ><b></b></h2></div><br/><br/>
							<label style="padding-left: 15px;">Total Response Time:  </label><label id= "lblName"></label><label>   Seconds</label>
						</div>
					</div>
					<table class="table table-bordered">
						<tbody>
						</tbody>
					</table>
				</div>
			</div> 
		</div>
    </body>
</html>