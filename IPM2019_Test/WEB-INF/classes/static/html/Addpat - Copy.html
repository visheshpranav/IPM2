<!DOCTYPE html>
<html>
<script language="JavaScript" type="text/javascript" src="../JScript/json2.js"></script>
<script language="JavaScript" type="text/javascript" src="../JScript/jquery-1.8.3.js"></script>

<style>

@font-face {
		font-family: 'AccentureRotis';
		src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}
	
body {
font-family: AccentureRotis;
}
	
input[type=text] {
  width: 75%;
  height: 50%;
  padding: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
  resize: vertical;
}

label {
  padding: 12px 12px 12px 0;
  display: inline-block;
  font-family: AccentureRotis;
}

input[type=button] {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 6px 20px;
  text-decoration: none;
  margin: 4px 2px;
  cursor: pointer;
}

</style>
<body onload="getready()">
<div>
  <div style="width: 35%;float:left">
  <fieldset id="fs_atr1" class="fieldset-checkbox" style="display: block; width: 5px;">
  <legend class="fs_legend"> File upload </legend>
  <div id="Div_Addditional1" style="overflow-y: auto; width: 350px; margin-left: 5px; padding-left: 5px;">
  <label id="lbl0" style="float: left; width: 150px;">Trade Insertion : </label>
  <input id="Tradeint" type="file" name="file" style="margin-left: 10px; float: left; top: 10px; font-family: AccentureRotis;">
   <label class="upload_lbl" style="float: left; font-size: 11px;">(supported file types: .xml(only xml)</label>
  <a style="text-decoration:underline; cursor: pointer;" onclick="document.getElementById('Tradeint').value=null">Remove</a><br></div>
 
  
  <br><br>
  
  <button type="submit" value="Upload" id="Btn_upload" class="btn btn-primary" onclick="upload_files()" style="width: 100px; margin-left: 140px; font-family: AccentureRotis;">Upload</button>
  
  </fieldset>
<br><br>
	<textarea id="txt1" name="txt" rows="20" cols="50" style= "margin-left: 4px;" readonly></textarea>
</div>

<div style="width: 25%;position:relative;float:left">
<label for="typo">Choose the typology:</label>
<select name="typo" id="typo">
</select>
<br>
<label for="type">Choose the type:</label>
<select name="type" id="type" style="margin-left:26px; width:142px" >
 <option value="Both">Both</option>
  <option value="download">Download Only</option>
 </select>
 <br>
  <!-- <button type="submit" value="submit" id="Button_sub" class="btn btn-primary"  style="width: 100px; margin-left: 140px; font-family: AccentureRotis;">Sumbit</button> -->
</div>


<div id ="tab" style="width: 35%;float:right;">

  <label class="list-heading1" id="CompareTest_lbl1">Enter header and headerpath values</label></br>
  
   <input type="button" onclick="myFunction()" value="+" />
	 <input type='button'  onclick="deleteNode1()" style="margin-left:60%" value='DeleteAll' />
  
<!--     <label>Header</label><input type='textbox' id="myInput1" name='Header' />
   
	 <label>HeaderPath</label><input type='textbox' id="myInput2" name='HeaderPath' style="width:40%" /><br> -->
	<form action="" method="post" name="myForm" id="myForm">
    </form>


<br><br>
<button type="submit" value="Upload" id="Btn_upload22" class="btn btn-primary"  onclick="getvaluesd()" style="width: 100px; margin-left: 140px; font-family: AccentureRotis;">Validate</button>



</div>
</div>
</body>




<script>

function getready()

{

   var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	
	fd.append("logtype","Trade Char");
	txtFile.open("POST", "../cgi-bin/murex_typology.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			//alert(allText);
			selecttrade(allText);
			}			
		};
		txtFile.send(fd);
}

 function selecttrade(typval)
	{
	
	var opt= typval.toString().replace(/[&\/\\#+()$~%.'":*?<>{}]/g, '')
	opt2=opt.replace(/[\[\]']+/g,'');
	var optionValues = opt2.split(',');
        for (var i=0;i<optionValues.length;i++){
            jQuery('#typo').append(jQuery("<option></option>").val(optionValues[i]).text(optionValues[i]))
        }
		
    }
	

function upload_files()
{

fileExtension = document.getElementById("Tradeint").value.substring(document.getElementById("Tradeint").value.lastIndexOf(".") + 1, document.getElementById("Tradeint").value.length);


if (fileExtension.toLowerCase() == "xml")
{

var file = document.getElementById("Tradeint").files[0];
var reader = new FileReader();
reader.onload = function (e) {
    var textArea = document.getElementById("txt1");
    textArea.value = e.target.result;
	var fileInput = document.getElementById('Tradeint');   
	var filename = fileInput.files[0].name;
	localStorage.setItem("Fname",filename);
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("values",e.target.result);
	fd.append("filename",filename);
	
	txtFile.open("POST", "../cgi-bin/savexml.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;	
			}			
		};
		txtFile.send(fd);
};
reader.readAsText(file);
alert("File uploaded...");
return true;
}
else
{
alert("Kindly select a valid file for upload");
document.getElementById('Tradeint').value=null;
return false; 
}

}




var x=1;
function myFunction() {

if (x>8)
{
alert("Limit exceed! cant add more than 4 values");
$(myForm).find("input:not(input[type='submit'])").remove();
x=1;
}
else
{
   var d = document.getElementById('myForm');
   d.innerHTML += "<input type='text' name='tbox' placeholder='Header' id='myinput"+ x++ +"' required />";
    d.innerHTML += "<input type='text' name='tbox' placeholder='HeaderPath' id='myinput"+ x++ +"' required /> <p>";
	}
}


function deleteNode1(){
   $(myForm).find("input:not(input[type='submit'])").remove();
   x=1;
}


  

function getvaluesd() {

	y=$(myForm).find("input:not(input[type='submit'])").length;
	for(i=1;i<y;i++)
	{
	if(document.getElementById('myinput'+y).value == "")
	{
    var valid="false";
	}
	}
	
	if(valid=="false")
	{
	alert("Header and headerpath values should be filled");
	}
	else 
		{

            tempObj = {};
		    	
			for(i=1;i<$(myForm).find("input:not(input[type='submit'])").length;i++)
			{
			j=i+1;
                tempObj[$('#myinput'+ i).val()] = $('#myinput'+ j).val();
			i++;
			}
	var json_text = JSON.stringify(tempObj, null, 2);
	var dropdown1= document.getElementById("typo").value;
	
	var dropdown2= document.getElementById("type").value;
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("typology",dropdown1.trim());
	fd.append("patterntype",dropdown2.trim());
	fd.append("filename",localStorage.getItem("Fname"));
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("headerjson",json_text);
	txtFile.open("POST", "../cgi-bin/murex_validation.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			alert(allText);
			}			
		};
		txtFile.send(fd);
	}
}

</script>
</html>