<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../styles/bootstrap.min.css">
  <script src="../JScript/jquery.min.js"></script>
  <script src="../JScript/bootstrap.min.js"></script>
  <script src="../JScript/d3.v4.min.js"></script>
 <!-- <script src="./JScript/d3.v3.min.js"></script>-->
  <style>
    .bar1 { fill: aqua; }
    .bar2 { fill: aqua; }
    .bar3 { fill: aqua; }
    .bar:hover {fill: orange; }
    .axis--x path { display: none; }
	.area {
        fill: blue;
        stroke: blue;
        stroke-width: 2;
    }
	.area1 {
        fill: orange;
        stroke: orange;
        stroke-width: 2;
    }
	.area2 {
        fill: maroon;
        stroke: maroon;
        stroke-width: 2;
    }
	
	.area3 {
        fill: lightblue;
        stroke: lightblue;
        stroke-width: 2;
    }
    .line {
        fill: none;
        stroke: royalblue;
        stroke-width: 2;
    }
	.line1 {
        fill: none;
        stroke: orange;
        stroke-width: 2;
    }
	.line2 {
        fill: none;
        stroke: green;
        stroke-width: 2;
    }	
	.line3 {
        fill: none;
        stroke: purple;
        stroke-width: 2;
    }
	.line4 {
        fill: none;
        stroke: MAROON;
        stroke-width: 2;
    }
    .dot {
        fill: royalblue;
        stroke: royalblue;
    }
	.dot1 {
        fill: blue;
        stroke: blue;
    }
	
	.btn.active.focus, .btn.active:focus, .btn.focus, .btn:active.focus, .btn:active:focus, .btn:focus {
     outline: none; 
    outline-offset: 0px;
	}
	
	.panel-group .panel-heading+.panel-collapse>.list-group, .panel-group .panel-heading+.panel-collapse>.panel-body {
		border-top: none;
	}

	.thumbs_lbl
	{
		margin-left: 10px;
		margin-top: 5px;
	}
	.opt_lbl
	{
		margin-left: 5px;
	}
	
	div.tooltip {
	  position: absolute;
	  text-align: center;
	  width: 40px;
	  height: 18px;
	  padding: 2px;
	  font: 12px sans-serif;
	  background: lightsteelblue;
	  border: 0px;
	  border-radius: 8px;
	  pointer-events: none;
	}

  </style>
</head>
<body>

<div class="container">
  <div class="panel-group" id="accordion">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a href="#" style="text-decoration: none;">Worker Process Distribution</a>
		  <button type="button" id="btn_worker" data-toggle="collapse" data-target="#collapse1" class="btn btn-primary active rounded-pill" style="float: right; margin-top: 5px;border-radius: 20px;">View Details</button><br/><br/>
		  <p style="font-size: 10px;"><span id="spn_worker" class="glyphicon glyphicon-exclamation-sign" style="font-size: 12px;"></span><label id="lbl_worker_opt" class="opt_lbl"></label><label id="lbl_worker" style="margin-left: 100px;"></label></p>
        </h4>
      </div>
      <div id="collapse1" class="panel-collapse collapse">
		<p style="font-size: 10px; margin-left: 15px;"><span id="spn_worker_cht" class="glyphicon glyphicon-thumbs-up" style="font-size: 12px;"></span><label id="lbl_worker_cht" class="thumbs_lbl"></label></p>
        <div class="panel-body" id="chart1"></div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a href="#" style="text-decoration: none;">Memory Usage</a>
		  <button type="button" id="btn_mem" class="btn btn-primary active" data-toggle="collapse" data-target="#collapse2" style="float: right; margin-top: 5px;border-radius: 20px;">View Details</button><br/><br/>
		  <p style="font-size: 10px;"><span id="spn_mem"  class="glyphicon glyphicon-exclamation-sign" style="font-size: 12px;"></span><label id="lbl_mem_opt" class="opt_lbl"></label><label id="lbl_memory" style="margin-left: 100px;"></label></p>
        </h4>
      </div>
      <div id="collapse2" class="panel-collapse collapse">
		<p style="font-size: 10px;margin-left: 15px;"><span id="spn_mem_cht" class="glyphicon glyphicon-thumbs-up" style="font-size: 12px;"></span><label id="lbl_mem_cht" class="thumbs_lbl"></label></p>
        <div class="panel-body" id="chart2"></div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a href="#" style="text-decoration: none;">CPU Usage</a>
		  <button type="button" id="btn_cpu" class="btn btn-primary active rounded-pill" data-toggle="collapse" data-target="#collapse3" style="float: right; margin-top: 5px;border-radius: 20px;">View Details</button><br/><br/>
		  <p style="font-size: 10px;"><span id="spn_cpu" class="glyphicon glyphicon-exclamation-sign" style="font-size: 12px;"></span><label id="lbl_cpu_opt" class="opt_lbl"></label><label id="lbl_cpu" style="margin-left: 100px;"></label></p>
        </h4>
      </div>
      <div id="collapse3" class="panel-collapse collapse">	  
		<p style="font-size: 10px; margin-left: 15px;"><span id="spn_cpu_cht" class="glyphicon glyphicon-thumbs-up" style="font-size: 12px;"></span><label id="lbl_cpu_cht" class="thumbs_lbl"></label></p>
        <div class="panel-body" id="chart3"></div>
      </div>
    </div>
	
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a href="#" style="text-decoration: none;">Queue Usage</a>
		  <button type="button" id="btn_queue" class="btn btn-primary active" data-toggle="collapse" data-target="#collapse4" style="float: right; margin-top: 5px;border-radius: 20px;">View Details</button><br/><br/>
		  <p style="font-size: 10px;"><span id="spn_queue" class="glyphicon glyphicon-exclamation-sign" style="font-size: 12px;"></span><label id="lbl_queue_opt" class="opt_lbl"></label><label id="lbl_queue" style="margin-left: 100px;"></label></p>
        </h4>
      </div>
      <div id="collapse4" class="panel-collapse collapse">	  
		<p style="font-size: 10px; margin-left: 15px;"><span id="spn_queue_cht" class="glyphicon glyphicon-thumbs-up" style="font-size: 12px;"></span><label id="lbl_queue_cht" class="thumbs_lbl"></label></p>
        <div class="panel-body" id="chart4"></div>
      </div>
    </div>
  </div> 
</div>
  <script>
  var rawFile = new XMLHttpRequest();
  rawFile.overrideMimeType("application/json");
  rawFile.open("GET", "Reports/IMP030_files/EXPORT_LT1_PF1_0615_0745_XLS.json", true);
  rawFile.onreadystatechange = function() {
  if (rawFile.readyState === 4 && rawFile.status == "200") {
		//callback(rawFile.responseText);		
		var myObj = JSON.parse(rawFile.responseText);
		var act_wp = "Active_WP"
		var dia_wp = "Dialog_WP"
		var pri_wp = "PRIV_WP"
		var act_se = "Active_Sessions"
		var user = "User"
		var system = "System"
		var idle = "Idle"
		//Queue
		var Dialog_Len = "Dialog_Queue_Length"
		var Update_Len = "Update_Queue_Length"
		var Enqueue_Len = "Enqueue_Queue_Length"
		//Memory
		var free_mem = "Free_Memory_MB"
		var alloc_mem = "Allocated_Ext_Memory_MB"
		var attac_mem = "Attached_Ext_Memory_MB"
		var heap_mem = "Heap_Memory_MB"
		
		//alert(rawFile.responseText);
		var dataset = [];
		var mem_dataset = [];
		var cpu_dataset = [];
		var queue_dataset = [];
		
		var color = d3.scaleOrdinal(d3.schemeCategory10);
  
		//alert(myObj[2].Values[0][user]);
		document.getElementById("lbl_worker").innerHTML = myObj[0].observation;
		if(myObj[0].observation != "NA")
		{
			document.getElementById("lbl_worker_opt").innerHTML = " Optimization Required";
			document.getElementById("lbl_worker_cht").innerHTML = myObj[0].recommendation;
		}
		else{
			document.getElementById("lbl_worker_opt").innerHTML = " No Optimization Required";
			document.getElementById("spn_worker").className = "glyphicon glyphicon-ok-sign";
			document.getElementById("spn_worker_cht").className = "";
		}
		if(myObj[1].observation != "NA")
		{
			document.getElementById("lbl_mem_opt").innerHTML = " Optimization Required";
			document.getElementById("lbl_mem_cht").innerHTML = myObj[1].recommendation
		}
		else{
			document.getElementById("lbl_mem_opt").innerHTML = " No Optimization Required";
			document.getElementById("spn_mem").className = "glyphicon glyphicon-ok-sign";;
			document.getElementById("spn_mem_cht").className = "";
		}
		if(myObj[2].observation != "NA")
		{
			document.getElementById("lbl_cpu_opt").innerHTML = " Optimization Required";
			document.getElementById("lbl_cpu_cht").innerHTML = myObj[2].recommendation;
		}
		else{
			document.getElementById("lbl_cpu_opt").innerHTML = " No Optimization Required";
			document.getElementById("spn_cpu").className = "glyphicon glyphicon-ok-sign";
			document.getElementById("spn_cpu_cht").className = "";	
		}
		if(myObj[3].observation != "NA")
		{
			document.getElementById("lbl_queue_opt").innerHTML = " Optimization Required";
			document.getElementById("lbl_queue_cht").innerHTML = myObj[3].recommendation;
		}
		else{
			document.getElementById("lbl_queue_opt").innerHTML = " No Optimization Required";
			document.getElementById("spn_queue").className = "glyphicon glyphicon-ok-sign";
			document.getElementById("spn_queue_cht").className = "";			
		}
		document.getElementById("lbl_memory").innerHTML = myObj[1].observation;
		document.getElementById("lbl_cpu").innerHTML = myObj[2].observation;
		document.getElementById("lbl_queue").innerHTML = myObj[3].observation;
		console.log(myObj[0].Values.length)
		for (var data_i=0; data_i < myObj[0].Values.length; data_i++)
		{
			
			//alert((myObj[1].Values[data_i].Timestamp).toString(), (parseInt(myObj[1].Values[data_i].Active_WP)).toString(), myObj[1].Values[data_i].Dialog_WP, myObj[1].Values[data_i].PRIV_WP, myObj[1].Values[data_i].Active_Sessions);
			dataset.push([""+(myObj[0].Values[data_i].Timestamp).toString()+"", myObj[0].Values[data_i][act_wp], myObj[0].Values[data_i][dia_wp], myObj[0].Values[data_i][pri_wp], myObj[0].Values[data_i][act_se]]);
			mem_dataset.push([""+(myObj[1].Values[data_i].Timestamp).toString()+"", myObj[1].Values[data_i][free_mem], myObj[1].Values[data_i][alloc_mem], myObj[1].Values[data_i][attac_mem], myObj[1].Values[data_i][heap_mem]]);
			cpu_dataset.push([""+(myObj[2].Values[data_i].Timestamp).toString()+"", myObj[2].Values[data_i][user], myObj[2].Values[data_i][system], myObj[2].Values[data_i][idle]]);
			queue_dataset.push([""+(myObj[3].Values[data_i].Timestamp).toString()+"", myObj[3].Values[data_i][Dialog_Len], myObj[3].Values[data_i][Update_Len], myObj[3].Values[data_i][Enqueue_Len]]);
			
		}
		console.table(dataset)
		console.table(mem_dataset)
		console.table(cpu_dataset)		
		console.table(queue_dataset)
		
		var div = d3.select("body").append("div")	
					.attr("class", "tooltip")	
					.style("opacity", 0);
		
		var margin = {top: 20, right: 20, bottom: 100, left: 50},
			  width = 960,
			  height = 400;
		  var parseTime = d3.timeParse("%H:%M:%S");

		  var xScale = d3.scaleBand()
						.rangeRound([0, width])
						.padding(0.1)
						.domain(dataset.map(function(d) {
						  return d[0];
						}));
			/*var xScale = d3.axisBottom()
						.scale(x)
						.tickFormat(d3.timeFormat("%H:%M:%S"));*/
			  yScale = d3.scaleLinear()
						.rangeRound([height, 0])
						.domain([0, d3.max(dataset, (function (d) {
						  return d[4];
						}))]);

		  var svg = d3.select("#chart1").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom);

		  var g = svg.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		  // axis-x
		  g.append("g")
			  .attr("class", "axis axis--x")
			  .attr("transform", "translate(0," + height + ")")
			  .call(d3.axisBottom(xScale))			
			.selectAll("text")
				.attr("y", 0)
				.attr("x", -49)
				.attr("dy", ".35em")
				.attr("font-weight", "bold")
				.attr("transform", "rotate(-90)")
				.style("text-anchor", "start");

		  // axis-y
		  g.append("g")
			  .attr("class", "axis axis--y")
			  .call(d3.axisLeft(yScale))			  
			  .attr("font-weight", "bold");

		  var bar = g.selectAll("rect")
			.data(dataset)
			.enter().append("g");

		  // bar chart
		  bar.append("rect")
			.attr("x", function(d) { return xScale(d[0]); })
			.attr("y", function(d) { return yScale(d[4]); })
			.attr("width", xScale.bandwidth())
			.attr("height", function(d) { return height - yScale(d[4]); })
			.attr("class", function(d) {
			  var s = "bar ";
			  if (d[1] < 400) {
				return s + "bar1";
			  } else if (d[1] < 800) {
				return s + "bar2";
			  } else {
				return s + "bar3";
			  }
			});

		  // labels on the bar chart
		  bar.append("text")
			.attr("dy", "1.3em")
			.attr("x", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			.attr("y", function(d) { return yScale(d[4]); })
			.attr("text-anchor", "middle")
			.attr("font-family", "sans-serif")
			.attr("font-size", "11px")
			.attr("fill", "black")
			.text(function(d) {
			  return d[4];
			});

		  // line chart
		  var line = d3.line()
			  .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .y(function(d) { return yScale(d[2]); })
			  .curve(d3.curveMonotoneX);

		  bar.append("path")
			.attr("class", "line") // Assign a class for styling
			.attr("d", line(dataset)) // 11. Calls the line generator
			//Our new hover effects
		    .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[2])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });

		  bar.append("circle") // Uses the enter().append() method
			  .attr("class", "dot") // Assign a class for styling
			  .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .attr("cy", function(d) { return yScale(d[2]); })
			  .attr("r", 3)
			  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[2])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
			  
		  // line chart
		  var line1 = d3.line()
			  .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .y(function(d) { return yScale(d[3]); })
			  .curve(d3.curveMonotoneX);

		  bar.append("path")
			.attr("class", "line1") // Assign a class for styling
			.attr("d", line1(dataset)); // 11. Calls the line generator

		  bar.append("circle") // Uses the enter().append() method
			  .attr("class", "dot") // Assign a class for styling
			  .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .attr("cy", function(d) { return yScale(d[3]); })
			  .attr("r", 3)
			  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[3])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
			  
		  // line chart
		  var line2 = d3.line()
			  .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .y(function(d) { return yScale(d[1]); })
			  .curve(d3.curveMonotoneX);

		  bar.append("path")
			.attr("class", "line2") // Assign a class for styling
			.attr("d", line2(dataset)) // 11. Calls the line generator
			//Our new hover effects
		    .on('mouseover', function (d, i) {
			     d3.select(this).transition()
				   .duration('50')
				   .attr('opacity', '.85')})
		    .on('mouseout', function (d, i) {
			     d3.select(this).transition()
				   .duration('50')
				   .attr('opacity', '1')});

		  bar.append("circle") // Uses the enter().append() method
			  .attr("class", "dot") // Assign a class for styling
			  .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .attr("cy", function(d) { return yScale(d[1]); })
			  .attr("r", 3)
			  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[1])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
		    
		  svg.append("text")
			  .attr("text-anchor", "end")
			  .attr("y", 6)
			  .attr("x", -140)
			  .attr("dy", ".55em")
			  .attr("transform", "rotate(-90)")
			  .attr("font-weight", "bold")
			  .text("Usage (in MB)");
		  svg.append("text")
			  .attr("text-anchor", "end")
			  .attr("y", 480)
			  .attr("x", 500)
			  .attr("dy", ".55em")
			  .attr("font-weight", "bold")
			  .text("Time");
		  
		  // add legend   
		  // create a list of keys
		var keys = ["Active_WP", "Dialog_WP", "PRIV_WP", "Active_Sessions"]

		// Usually you have a color scale in your chart already 
		var color = d3.scaleOrdinal()
			 .domain(keys)
			 .range(['green','royalblue','orange','aqua'])

		// Add one dot in the legend for each name.
		var lineLegend = svg.selectAll(".lineLegend").data(keys)
			 .enter().append("g")
			 .attr("class","lineLegend")
			 .attr("transform", function (d,i) {
			  position = height + margin.bottom
					return "translate(" + (200+(i*150))+"," + position + ")";
				});
		lineLegend.append("text").text(function (d) {return d;})
			 .attr("transform", "translate(15,9)") //align texts with boxes
			 .attr("font-weight","bold");
		lineLegend.append("rect")
			 .attr("fill", function (d, i) {return color(d); })
			 .attr("width", 15)
			 .attr("height", 10);
			 
		//////////////////////  CPU Usage  ////////////////////////////
		
		var margin = {top: 20, right: 20, bottom: 100, left: 60},
			  width = 960,
			  height = 400;

		  var xScale = d3.scaleBand()
						.rangeRound([0, width])
						.padding(0.1)
						.domain(cpu_dataset.map(function(d) {
						  return d[0];
						}));
			  yScale = d3.scaleLinear()
						.rangeRound([height, 0])
						.domain([0, d3.max(cpu_dataset, (function (d) {
						  return d[3];
						}))]);

		  var svg = d3.select("#chart3").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom);

		  var g = svg.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		  // axis-x
		  g.append("g")
			  .attr("class", "axis axis--x")
			  .attr("transform", "translate(0," + height + ")")
			  .call(d3.axisBottom(xScale))
			.selectAll("text")
				.attr("y", 0)
			    .attr("x", -49)
				.attr("dy", ".35em")
				.attr("font-weight", "bold")
				.attr("transform", "rotate(-90)")
				.style("text-anchor", "start");

		  // axis-y
		  g.append("g")
			  .attr("class", "axis axis--y")
			  .call(d3.axisLeft(yScale));

		  var bar = g.selectAll("rect")
			.data(cpu_dataset)
			.enter().append("g");
			
		  svg.append("text")
			  .attr("text-anchor", "end")
			  .attr("y", 6)
			  .attr("x", -140)
			  .attr("dy", ".55em")
			  .attr("font-weight", "bold")
			  .attr("transform", "rotate(-90)")
			  .text("CPU Usage (in MB)");
		 svg.append("text")
			  .attr("text-anchor", "end")
			  .attr("y", 480)
			  .attr("x", 500)
			  .attr("dy", ".55em")
			  .attr("font-weight", "bold")
			  .text("Time");

		  // bar chart
		  /*bar.append("rect")
			.attr("x", function(d) { return xScale(d[0]); })
			.attr("y", function(d) { return yScale(d[1]); })
			.attr("width", xScale.bandwidth())
			.attr("height", function(d) { return height - yScale(d[1]); })
			.attr("class", function(d) {
			  var s = "bar ";
			  if (d[1] < 400) {
				return s + "bar1";
			  } else if (d[1] < 800) {
				return s + "bar2";
			  } else {
				return s + "bar3";
			  }
			});

		  // labels on the bar chart
		  bar.append("text")
			.attr("dy", "1.3em")
			.attr("x", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			.attr("y", function(d) { return yScale(d[1]); })
			.attr("text-anchor", "middle")
			.attr("font-family", "sans-serif")
			.attr("font-size", "11px")
			.attr("fill", "black")
			.text(function(d) {
			  return d[1];
			});*/
			
		  // line chart
		  var line4 = d3.area()
			  //.x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  //.y(function(d) { return yScale(d[3]); })
			  .x(function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .y0( height )
		      .y1(function(d) { return yScale(d[3]); })
			  .curve(d3.curveMonotoneX);

		  bar.append("path")
			.attr("class", "area3") // Assign a class for styling
			.attr("d", line4(cpu_dataset)); // 11. Calls the line generator

		  bar.append("circle") // Uses the enter().append() method
			  .attr("class", "dot") // Assign a class for styling
			  .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .attr("cy", function(d) { return yScale(d[3]); })
			  .attr("r", 3)
			  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[3])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
		  
		  // line chart
		  var line = d3.area()
			  //.x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  //.y(function(d) { return yScale(d[3]); })
			  .x(function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .y0( height )
		      .y1(function(d) { return yScale(d[1]); })
			  .curve(d3.curveMonotoneX);

		  bar.append("path")
			.attr("class", "area2") // Assign a class for styling
			.attr("d", line(cpu_dataset)); // 11. Calls the line generator

		  bar.append("circle") // Uses the enter().append() method
			  .attr("class", "dot") // Assign a class for styling
			  .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .attr("cy", function(d) { return yScale(d[1]); })
			  .attr("r", 3)
			  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[1])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
			  
		  // line chart
		  var line2 = d3.area()
			  //.x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  //.y(function(d) { return yScale(d[2]); })
			  .x(function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .y0( height )
		      .y1(function(d) { return yScale(d[2]); })
			  .curve(d3.curveMonotoneX);

		  bar.append("path")
			.attr("class", "area") // Assign a class for styling
			.attr("d", line2(cpu_dataset)); // 11. Calls the line generator

		  bar.append("circle") // Uses the enter().append() method
			  .attr("class", "dot") // Assign a class for styling
			  .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
			  .attr("cy", function(d) { return yScale(d[2]); })
			  .attr("r", 3)
			  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[2])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
			  
		// add legend   
		  // create a list of keys
		var keys = ["User", "Idle", "System"]

		// Usually you have a color scale in your chart already 
		var color = d3.scaleOrdinal()
			 .domain(keys)
			 .range(['blue','lightblue','maroon'])

		// Add one dot in the legend for each name.
		var lineLegend = svg.selectAll(".lineLegend").data(keys)
			 .enter().append("g")
			 .attr("class","lineLegend")
			 .attr("transform", function (d,i) {
			  position = height + margin.bottom
					return "translate(" + (350+(i*100))+"," + position + ")";
				});
		lineLegend.append("text").text(function (d) {return d;})
			 .attr("transform", "translate(15,9)") //align texts with boxes
			 .attr("font-weight","bold");
		lineLegend.append("rect")
			 .attr("fill", function (d, i) {return color(d); })
			 .attr("width", 15)
			 .attr("height", 10);
			 
			  
			  
////////////////////////  Memory Usage  ///////////////////////////////

var margin = {top: 20, right: 20, bottom: 100, left: 60},
      width = 960,
      height = 400;

var xScale = d3.scaleBand()
                .rangeRound([0, width])
                .padding(0.1)
                .domain(mem_dataset.map(function(d) {
                  return d[0];
                }));
      yScale = d3.scaleLinear()
                .rangeRound([height, 0])
                .domain([0, d3.max(mem_dataset, (function (d) {
                  return d[1];
                }))]);

  var svg = d3.select("#chart2").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

  var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		svg.append("text")
			  .attr("text-anchor", "end")
			  .attr("y", 5)
			  .attr("x", -140)
			  .attr("dy", ".55em")
			  .attr("font-weight", "bold")			  
			  .attr("transform", "rotate(-90)")
			  .text("Memory Usage (in MB)");
	svg.append("text")
			  .attr("text-anchor", "end")
			  .attr("y", 480)
			  .attr("x", 500)
			  .attr("dy", ".55em")
			  .attr("font-weight", "bold")
			  .text("Time");

  // axis-x
  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(xScale))
	.selectAll("text")
		.attr("y", 0)
		.attr("x", -49)
		.attr("dy", ".35em")
		.attr("font-weight", "bold")
		.attr("transform", "rotate(-90)")
		.style("text-anchor", "start");

  // axis-y
  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(yScale))
	  .attr("font-weight", "bold");

  var bar = g.selectAll("rect")
    .data(mem_dataset)
    .enter().append("g");

  // bar chart
   /*bar.append("rect")
    .attr("x", function(d) { return xScale(d[0]); })
    .attr("y", function(d) { return yScale(d[1]); })
    .attr("width", xScale.bandwidth())
    .attr("height", function(d) { return height - yScale(d[1]); })
    .attr("class", function(d) {
      var s = "bar ";
      if (d[1] < 400) {
        return s + "bar1";
      } else if (d[1] < 800) {
        return s + "bar2";
      } else {
        return s + "bar3";
      }
    });

  // labels on the bar chart
  bar.append("text")
    .attr("dy", "1.3em")
    .attr("x", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
    .attr("y", function(d) { return yScale(d[1]); })
    .attr("text-anchor", "middle")
    .attr("font-family", "sans-serif")
    .attr("font-size", "11px")
    .attr("fill", "black")
    .text(function(d) {
      return d[1];
    }); */
  // line chart
  var line1 = d3.line()
      .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .y(function(d) { return yScale(d[1]); })
      .curve(d3.curveMonotoneX);

  bar.append("path")
    .attr("class", "line1") // Assign a class for styling
    .attr("d", line1(mem_dataset)); // 11. Calls the line generator

  bar.append("circle") // Uses the enter().append() method
      .attr("class", "dot") // Assign a class for styling
      .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .attr("cy", function(d) { return yScale(d[1]); })
      .attr("r", 3)
	  .on("mouseover", function(d) {
		   div.transition()
			 .duration(200)
			 .style("opacity", .9);
		   div.html(d[1])
			 .style("left", (d3.event.pageX) + "px")
			 .style("top", (d3.event.pageY) + "px");
		   })
		 .on("mouseout", function(d) {
		   div.transition()
			 .duration(500)
			 .style("opacity", 0);
		   });
  // line chart
  var line2 = d3.line()
      .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .y(function(d) { return yScale(d[2]); })
      .curve(d3.curveMonotoneX);

  bar.append("path")
    .attr("class", "line2") // Assign a class for styling
    .attr("d", line2(mem_dataset)); // 11. Calls the line generator

  bar.append("circle") // Uses the enter().append() method
      .attr("class", "dot") // Assign a class for styling
      .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .attr("cy", function(d) { return yScale(d[2]); })
      .attr("r", 3)
	  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[2])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
	  
  // line chart
  var line3 = d3.line()
      .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .y(function(d) { return yScale(d[3]); })
      .curve(d3.curveMonotoneX);

  bar.append("path")
    .attr("class", "line3") // Assign a class for styling
    .attr("d", line3(mem_dataset)); // 11. Calls the line generator

  bar.append("circle") // Uses the enter().append() method
      .attr("class", "dot") // Assign a class for styling
      .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .attr("cy", function(d) { return yScale(d[3]); })
      .attr("r", 3)
	  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[3])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
  
  // line chart
  var line4 = d3.line()
      .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .y(function(d) { return yScale(d[4]); })
      .curve(d3.curveMonotoneX);

  bar.append("path")
    .attr("class", "line4") // Assign a class for styling
    .attr("d", line4(mem_dataset)); // 11. Calls the line generator

  bar.append("circle") // Uses the enter().append() method
      .attr("class", "dot") // Assign a class for styling
      .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .attr("cy", function(d) { return yScale(d[4]); })
      .attr("r", 3)
	  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[4])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
	  
// add legend   
		  // create a list of keys
		var keys = ["Free_Memory_MB", "Allocated_Ext_Memory_MB", "Attached_Ext_Memory_MB", "Heap_Memory_MB"]

		// Usually you have a color scale in your chart already 
		var color = d3.scaleOrdinal()
			 .domain(keys)
			 .range(['orange','green','purple','maroon'])

		// Add one dot in the legend for each name.
		var lineLegend = svg.selectAll(".lineLegend").data(keys)
			 .enter().append("g")
			 .attr("class","lineLegend")
			 .attr("transform", function (d,i) {
			  position = height + margin.bottom
					return "translate(" + (120+(i*220))+"," + position + ")";
				});
		lineLegend.append("text").text(function (d) {return d;})
			 .attr("transform", "translate(15,9)") //align texts with boxes
			 .attr("font-weight","bold");
		lineLegend.append("rect")
			 .attr("fill", function (d, i) {return color(d); })
			 .attr("width", 10)
			 .attr("height", 10);

//////////////////////////////////// QUEUE Usage ///////////////////////////////////
	var margin = {top: 20, right: 20, bottom: 100, left: 40},
      width = 960,
      height = 400;

  var xScale = d3.scaleBand()
                .rangeRound([0, width])
                .padding(0.1)
                .domain(queue_dataset.map(function(d) {
                  return d[0];
                }));
      yScale = d3.scaleLinear()
                .rangeRound([height, 0])
                .domain([0, d3.max(queue_dataset, (function (d) {
                  return d[1];
                }))]);

  var svg = d3.select("#chart4").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

  var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  // axis-x
  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(xScale))
	.selectAll("text")
		.attr("y", 0)
		.attr("x", -49)
		.attr("dy", ".35em")
		.attr("font-weight", "bold")
		.attr("transform", "rotate(-90)")
		.style("text-anchor", "start");

  // axis-y
  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(yScale));

  var bar = g.selectAll("rect")
    .data(queue_dataset)
    .enter().append("g");

  svg.append("text")
		  .attr("text-anchor", "end")
		  .attr("y", 6)
		  .attr("x", -140)
		  .attr("dy", ".55em")
		  .attr("font-weight", "bold")
		  .attr("transform", "rotate(-90)")
		  .text("Queue Usage (in MB)");
			  
	 svg.append("text")
		  .attr("text-anchor", "end")
		  .attr("y", 480)
		  .attr("x", 500)
		  .attr("dy", ".55em")
		  .attr("font-weight", "bold")
		  .text("Time");

  // bar chart
  bar.append("rect")
    .attr("x", function(d) { return xScale(d[0]); })
    .attr("y", function(d) { return yScale(d[1]); })
    .attr("width", xScale.bandwidth())
    .attr("height", function(d) { return height - yScale(d[1]); })
    .attr("class", function(d) {
      var s = "bar ";
      if (d[1] < 400) {
        return s + "bar1";
      } else if (d[1] < 800) {
        return s + "bar2";
      } else {
        return s + "bar3";
      }
    });

  // labels on the bar chart
  bar.append("text")
    .attr("dy", "1.3em")
    .attr("x", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
    .attr("y", function(d) { return yScale(d[2]); })
    .attr("text-anchor", "middle")
    .attr("font-family", "sans-serif")
    .attr("font-size", "11px")
    .attr("fill", "black")
    .text(function(d) {
      return d[2];
    });

  // line chart
  var line = d3.line()
      .x(function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .y(function(d) { return yScale(d[2]); })
      .curve(d3.curveMonotoneX);

  bar.append("path")
    .attr("class", "line") // Assign a class for styling
    .attr("d", line(queue_dataset)); // 11. Calls the line generator

  bar.append("circle") // Uses the enter().append() method
      .attr("class", "dot") // Assign a class for styling
      .attr("cx", function(d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
      .attr("cy", function(d) { return yScale(d[2]); })
      .attr("r", 3)
	  .on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   div.html(d[2])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   });
	  
	  // add legend   
		  // create a list of keys
		var keys = ["Inbound_active", "Outbound_active", "Dialog_Queue_Length", "Update_Queue_Length","Enqueue_Queue_Length"]

		// Usually you have a color scale in your chart already 
		var color = d3.scaleOrdinal()
			 .domain(keys)
			 .range(['orange','green','purple','maroon','blue'])

		// Add one dot in the legend for each name.
		var lineLegend = svg.selectAll(".lineLegend").data(keys)
			 .enter().append("g")
			 .attr("class","lineLegend")
			 .attr("transform", function (d,i) {
			  position = height + margin.bottom
					return "translate(" + (50+(i*170))+"," + position + ")";
				});
		lineLegend.append("text").text(function (d) {return d;})
			 .attr("transform", "translate(15,9)") //align texts with boxes
			 .attr("font-weight","bold");
		lineLegend.append("rect")
			 .attr("fill", function (d, i) {return color(d); })
			 .attr("width", 10)
			 .attr("height", 10);

	  
	}
  }
  rawFile.send(null);
  
$('#btn_queue').click(function(){ //you can give id or class name here for $('button')
    $(this).text(function(i,old){
        return old=='View Details' ?  'Hide Details' : 'View Details';
    });
});

$('#btn_cpu').click(function(){ //you can give id or class name here for $('button')
    $(this).text(function(i,old){
        return old=='View Details' ?  'Hide Details' : 'View Details';
    });
});

$('#btn_mem').click(function(){ //you can give id or class name here for $('button')
    $(this).text(function(i,old){
        return old=='View Details' ?  'Hide Details' : 'View Details';
    });
});

$('#btn_worker').click(function(){ //you can give id or class name here for $('button')
    $(this).text(function(i,old){
        return old=='View Details' ?  'Hide Details' : 'View Details';
    });
});

  </script> 
  </body>
</html>