<!DOCTYPE html>
<html>
<script language="JavaScript" type="text/javascript" src="../JScript/json2.js"></script>
<script language="JavaScript" type="text/javascript" src="../JScript/jquery-1.8.3.js"></script>

<style>

@font-face {
		font-family: 'AccentureRotis';
		src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}
	
body {
font-family: AccentureRotis;
}
	

label {
  padding: 12px 12px 12px 0;
  display: inline-block;
  font-family: AccentureRotis;
}

html, body { font-family: 'AccentureRotis'; }

table { border-collapse: collapse; }

tbody tr:first-child { pointer-events: none; font-weight:bold} 
table tr td {
  border: 1px solid #000;
  padding: 10px;
}

table tr:nth-child(odd) { background: #f4f4f4; }

tr:hover {
background-color:#ffff99!important;
cursor:pointer;
}

td{
word-break: break-all;
font-size:14px;
}

table{
table-layout:fixed;
width:75%;
float:right;
}


</style>
<body>
<div id="container" style="margin-top:20px;margin-bottom:10px;float:right;" ></div>
<div style="position:fixed;float:left;">
  <label style="margin-left:5%" class="list-heading1" id="CompareTest_lbl1">Select values need to be deleted</label></br>
  <div style="width: 100%;float:left">
 <label style="margin-left:5%" for="Pattern">Choose a Pattern:</label>

<select name="typepat" id="typepat" style="margin-left:5%" onchange="selectpattern()">
  <option disabled selected value> -- select an option -- </option>
  <option value="Trade Char">Trade Insertion</option>
  <option value="Deliverable">Deliverable</option>
 </select>
 <br><br><br><br><br>
 
 
 <label id="tradefamily" style="margin-left:5%; display:none;" for="Pattern">Choose a family:</label>
<select id="mySelect" style="display:none; margin-left:5%"   onchange="getselecttrade()">






</div>

</div>

</body>




<script>

function selectpattern()
{

document.getElementById("mySelect").innerHTML = "";
var e = document.getElementById("typepat");

if(e.value == "Deliverable")

{
alert("Data not avail");

}

else
{
    var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	localStorage.setItem("logtype",e.value);
	fd.append("logtype",e.value);
	txtFile.open("POST", "../cgi-bin/murex_typology.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			//alert(allText);
			selecttrade(allText);
			}			
		};
		txtFile.send(fd);
		}
	
}


 

    function selecttrade(typval)
	{
	document.getElementById("mySelect").style.display="";
	document.getElementById("tradefamily").style.display="";
	var opt= typval.toString().replace(/[&\/\\#+()$~%.'":*?<>{}]/g, '')
	opt2=opt.replace(/[\[\]']+/g,'');
	var optionValues = opt2.split(',');
        for (var i=0;i<optionValues.length;i++){
            jQuery('#mySelect').append(jQuery("<option></option>").val(optionValues[i]).text(optionValues[i]))
        }
		jQuery('#mySelect').append(jQuery("<option disabled selected value> -- select an option -- </option>"))
    }
	
	
    function getselecttrade()
	{
	var t = document.getElementById("mySelect").value.trim();
	
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("logtype",localStorage.getItem("logtype"));
	localStorage.setItem("typology",t);
	fd.append("typology",t);
	txtFile.open("POST", "../cgi-bin/murex_patterns.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			myfunction(allText);
			}			
		};
		
		txtFile.send(fd);
		
	}
	
	
	function myfunction(tableData) {
	var opt= tableData.toString().replace(/[&\\\#+()$~%.'":*?<>{}]/g, '');
	opt2=opt.replace(/[\[\]']+/g,'');
	var optionValues = opt2.split(',');
	optionValues.splice(0,0,"HEADER");
	optionValues.splice(1,0,"HEADERPATH");
	
  var data = optionValues;
  
  var perrow = 2,
      html = "<table id=tableMain><caption><b> Please click on a row to select the row for deletion: </b></caption><tr>";

  for (var i=0; i<data.length; i++) {
     html += `<td>${data[i]}</td>`;

    var next = i+1;
    if (next%perrow==0 && next!=data.length) {
      html += "</tr><tr>";
    }
  }
  html += "</tr></table>";
 	document.getElementById("container").innerHTML = html;
	  let thetable = document.getElementById('tableMain').getElementsByTagName('tbody')[0];
            for (let i = 0; i < thetable.rows.length; i++)
                {
                    thetable.rows[i].onclick = function()
                    {
                        TableRowClick(this);
                    };
                }                      

            function TableRowClick(therow) {
	            let msg = therow.cells[0].innerHTML;
                msg2=msg.trim();
				alert("Header selected for delete: "+msg2);
				var k= getConfirmation();
				if(k==true)
				{
				
				var txtFile = new XMLHttpRequest();		
				var fd = new FormData();
	
				fd.append("user_id",localStorage.getItem("ipm_UserId"));
				fd.append("logtype",localStorage.getItem("logtype"));
				fd.append("typology",localStorage.getItem("typology"));
				fd.append("header",msg2);
				txtFile.open("POST", "../cgi-bin/murex_delete_pattern.py",true);
				txtFile.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200)
				{
				allText = this.responseText;
				alert("Sucessfully deleted from the list");
				myfunction(allText);
				}			
				};
				txtFile.send(fd);
				}      
                else
				{
				alert("Delete Process Cancelled")
				}
				}
	}
	
	
	
	
	function getConfirmation() {
               var retVal = confirm("Do you want to Proceed?");
               if( retVal == true ) {
                  
                  return true;
               } else {
                  
                  return false;
               }
            }
	
</script>
</html>