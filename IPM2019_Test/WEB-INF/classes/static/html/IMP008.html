<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" href="../styles/font-awesome/css/font-awesome.min.css">

    <style>
	@font-face {
	font-family: 'AccentureRotis';
	src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}
	
	body {
		font-family: AccentureRotis;
	 }
	
	
        /* Style the tab */
        
        .tab {
            overflow: hidden;
            margin-left: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        /* Style the buttons inside the tab */
        
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            border-radius: 5px;
            outline: none;
            cursor: pointer;
            padding: 6px;
            transition: 0.3s;
            font-size: 14px;
        }
        /* Change background color of buttons on hover */
        
        .tab button:hover {
            background-color: #ddd;
        }
        /* Create an active/current tablink class */
        
        .tab button.active {
            background-color: #ccc;
        }
        /* Style the tab content */
        
        .tabcontent {
            display: none;
            margin-left: 10px;
            margin-right: 10px;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
            height: 250px;
        }
        /* Style the close button */
        
        .topright {
            float: right;
            cursor: pointer;
            font-size: 28px;
        }
        
        .topright:hover {
            color: red;
        }
        
        .input-group-addon {
            display: inline-block;
            height: 24px;
            width: 1%;
            white-space: nowrap;
            vertical-align: middle;
            font-size: 14px;
            font-weight: 400;
            line-height: 1;
            color: #555;
            text-align: center;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        #Rollview {
            font-family: AccentureRotis;
            border-collapse: collapse;
            width: 90%;
        }
        
        #Rollview td,
        #Rollview th {
            border: 1px solid #ddd;
            padding: 8px;
        }
        
        #Rollview tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        #Rollview tr:hover {
            background-color: #ddd;
        }
        
        #Rollview th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #365890;
            color: white;
        }
        
        #tbl_content,
        #bp_tbl_content {
            font-family: AccentureRotis;
            border-collapse: collapse;
            width: 98%;
        }
        
        #tbl_content td,
        #tbl_content th,
        #bp_tbl_content td,
        #bp_tbl_content th {
            border: 1px solid #ddd;
            padding: 8px;
        }
        
        #tbl_content tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        #tbl_content tr:hover {
            background-color: #ddd;
        }
        
        #bp_tbl_content tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        #bp_tbl_content tr:hover {
            background-color: #ddd;
        }
        
        #tbl_content th,
        #bp_tbl_content th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #5d8aa8;
            color: white;
        }
        
        object {
            height: 100%;
            width: 100%;
        }
        /* The Modal (background) */
        
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }
        /* Modal Content/Box */
        
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 35%;
            /* Could be more or less, depending on screen size */
        }
        /* The Close Button */
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
   <script src="../JScript/moment-with-locales.min.js"></script>
    <link rel="stylesheet" href="../styles/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="../styles/bootstrap.min.css">
    <script src="../JScript/jquery.min.1.12.4.js"></script>
    <script src="../JScript/bootstrap-datetimepicker.min.js"></script>
    <script src="../JScript/bootstrap.min.js"></script>
     <script type="text/javascript" src="../JScript/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="../JScript/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="../JScript/jquery.tablesorter.widgets.js"></script>
    <script src="../JScript/Lapam.js"></script>
</head>

<body style="font-size: 12px; background-color: #ffffff00;" onload="displayLogtime()">
    <label id="StatusMode_lbl" style="float: left; margin-left: 10px; width: 100%; "></label>
    <label id="Lbl_lt" style="margin-left: 10px; margin-top: 5px;"><b>Log Time: </b></label>
    <label id="logtime_lbl" style="margin-left: 10px; margin-top: 5px;"></label>
    <br/>
    <br/>
    <label id="Lbl_st" style="margin-left: 10px; float: left; margin-right: 10px; margin-top: 2px;"><b>Start Datetime: </b></label>
    <div class='input-group date' id='datetimepicker1' style="float: left;">
        <input type='text' id="start_datepicker" style="width: 150px; float: left; margin" />
        <span class="input-group-addon" style="float: left; padding: 5px; width: 23px; height: 23px; ">
		<span class="glyphicon glyphicon-calendar" style="float: left;"></span>
        </span>
    </div>
    <label id="Lbl_et" style="margin-left: 10px; float: left; margin-right: 10px; margin-top: 2px;"><b>End Datetime: </b></label>
    <div class='input-group date' id='datetimepicker2'>
        <input type='text' id="end_datepicker" style="width: 150px; float: left; margin" />
        <span class="input-group-addon" style="float: left;  padding: 5px; width: 23px; height: 23px; ">
		<span class="glyphicon glyphicon-calendar" style="float: left;"></span>
        </span>
    </div>
    <br/>
    <label style="margin-left: 10px; margin-top: 10px; margin-right: 10px;"><b>Search Key:</b></label>
    <input type="text" id="Txt_search" name="search_input" maxlength="100" style="width: 220px; height: 26px; margin-left: 10px;">
    <br/>
    <br/>
    <!--<select id="Drp_users" style="width: 200px; margin-left: 10px; height: 26px;" onchange="displayUsageDetails()"> </select><br/><br/>-->
    <button id="Btn_getDetails" onclick="getSearchValue()" style="margin-left: 150px;margin-bottom: 10px; ">Get details</button>
    <br/>
    <div class="tab">
        <button class="tablinks" onclick="fetchImperatives(event, 'UsageVsFailure')" id="defaultOpen">UsageVsFailure</button>
        <button class="tablinks" onclick="fetchImperatives(event, 'dataCombination')" id="Btn_dc">Data Combination</button>
    </div>

    <div id="UsageVsFailure" class="tabcontent">
        <div id="Rollview" class="component"></div>
    </div>

    <div id="dataCombination" class="tabcontent">
        <div id="tbl_content">
            <label id="Service_lbl" style="font-size: 14px; width: 150px; float: left; margin-bottom: 0px;">Select ServiceCall: </label>
            <select id="key_drp" onchange="DataCombination()" style="width: 300px; float: left; margin-bottom: 0px;"></select>
            <div id="result-content" style="height: 220px; width: 98%;overflow-y: auto;">
                <br/>
                <table id="drilldown_tbl">
                </table>
            </div>
        </div>
    </div>
    <!-- The Modal -->
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div id="Div_Keys" class="modal-content">
            <p><b>Select Tag value for the given input: </b></p>
            <span class="close">&times;</span>
            <br/>
        </div>

    </div>
    <script>
        //variable declaration
        var serviceCall_key = []
        var value_arr = []

        // function to display user details in dropdown field
        function displayLogtime() {
            getObservation();
            readTimeTextFile();
            getServicecallName();
            localStorage.setItem("search_value", "");
            var startDate = localStorage.getItem("startdate"), // some start date
                endDate = localStorage.getItem("enddate"), // some end date
                dateRange = []; // array to hold the range 
            var d = new Date(startDate);
            d.setDate(d.getDate());
            startDate = moment(d).format('YYYY-MM-DD HH:mm');
            var d = new Date(endDate);
            d.setDate(d.getDate());
            endDate = moment(d).format('YYYY-MM-DD HH:mm');
            var d = new Date(startDate);
            d.setDate(d.getDate() + 1);
            startDate1 = moment(d).format('YYYY-MM-DD HH:mm');

            $('#datetimepicker1').datetimepicker({
                minDate: startDate,
                defaultDate: startDate
            });

            $('#datetimepicker2').datetimepicker({
                maxDate: endDate,
                minDate: startDate
            });
            if (sessionStorage.getItem("isOnline") == "true") {
                document.getElementById("logtime_lbl").innerHTML = "";
                document.getElementById("start_datepicker").value = "";
                document.getElementById("end_datepicker").value = "";
            } else {
                document.getElementById("logtime_lbl").innerHTML = "<b>" + localStorage.getItem("startdate") + " to " + localStorage.getItem("enddate") + "</b>";
            }

            displayUsageDetails();
            <!-- document.getElementById("defaultOpen").disabled = true; -->
            <!-- document.getElementById("Btn_dc").disabled = true; -->
            <!-- document.getElementById("Btn_bp").disabled = true; -->
            getObservation();
        }

        function getServicecallName() {
            var xhttp = new XMLHttpRequest();
            var fd = new FormData();
            fd.append("user_id", localStorage.getItem("ipm_UserId"));
            fd.append("rep_id", localStorage.getItem("rep_id"));
            fd.append("Imperative_name", sessionStorage.getItem("Imperative_name"));
            if (sessionStorage.getItem("isOnline") == "true") {
                fd.append("mode", "ONL");
            } else {
                fd.append("mode", "OFL");
            }
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var service_list_arr = this.responseText.toString().split("'");
                    var key_drp = document.getElementById("key_drp");
                    var test_length = key_drp.options.length;
                    for (i = 0; i < test_length; i++) {
                        key_drp.options[0] = null;
                    }
                    for (var ser_i = 1; ser_i < service_list_arr.length; ser_i = ser_i + 2) {
                        var option = document.createElement("option");
						if(service_list_arr[ser_i] != "Usage")
						{
							option.text = service_list_arr[ser_i];
							key_drp.add(option, key_drp[0]);
						}
                    }
                }
            };
            xhttp.open("POST", "../cgi-bin/getFilenameFromDir.py", true);
            xhttp.send(fd);
        }

        function readTimeTextFile() {
            var filename = "";
            var current_date =  new  Date().getFullYear() + '-' + ("0" + (new  Date().getMonth() + 1)).slice(-2) + '-' + ("0" + new  Date().getDate()).slice(-2);
            if (sessionStorage.getItem("isOnline") == "true") {
                $('#Lbl_lt').attr('disabled', 'disabled');
                $('#start_datepicker').attr('disabled', 'disabled');
                $('#datetimepicker1').attr('disabled', 'disabled');
                $('#end_datepicker').attr('disabled', 'disabled');
                $('#datetimepicker2').attr('disabled', 'disabled');
                $('#logtime_lbl').attr('disabled', 'disabled');
				$('#Lbl_lt').css('display', 'none');
                $('#start_datepicker').css('display', 'none');
                $('#datetimepicker1').css('display', 'none');
                $('#end_datepicker').css('display', 'none');
                $('#datetimepicker2').css('display', 'none');
                $('#logtime_lbl').css('display', 'none');
                $('#Lbl_st').css('display', 'none');
                $('#Lbl_et').css('display', 'none');
				
                document.getElementById("logtime_lbl").innerHTML = "";
                document.getElementById("StatusMode_lbl").innerHTML = "<i class=\"fa fa-circle\" style=\"color: green;\"></i> ";
                document.getElementById("StatusMode_lbl").style.color = "green";
                file_name = localStorage.getItem("ipm_appname") + "_" + sessionStorage.getItem("Imperative_name");
                if (localStorage.getItem("online_tp") == "false") {
                    filename = "online/" + file_name + "_ONL_" + current_date + ".csv";
                } else {
                    filename = "online/" + file_name + "_TP_" + current_date + ".csv";
                }
                //filename = "online\\"+localStorage.getItem("ipm_appname").toLowerCase()+"\\imp005_nfv_060319.json";
            } else {
                $('#Lbl_lt').removeAttr('disabled');
                $('#start_datepicker').removeAttr('disabled');
                $('#datetimepicker1').removeAttr('disabled');
                $('#end_datepicker').removeAttr('disabled');
                $('#datetimepicker2').removeAttr('disabled');
                $('#logtime_lbl').removeAttr('disabled');
				$('#Lbl_lt').css('display', 'block');
                $('#start_datepicker').css('display', 'block');
                $('#datetimepicker1').css('display', 'block');
                $('#end_datepicker').css('display', 'block');
                $('#datetimepicker2').css('display', 'block');
                $('#logtime_lbl').css('display', 'block');
                $('#Lbl_st').css('display', 'block');
                $('#Lbl_et').css('display', 'block');
                var log_folder = localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("rep_id");
                //var log_folder = "1_1_nov21_2";
                var file_name = localStorage.getItem("ipm_appname") + "_" + localStorage.getItem("reportname").toLowerCase() + "_usage vs failure analysis";
                var filename = "Reports/" + log_folder + "/" + file_name + "_fail_response.txt";
                document.getElementById("StatusMode_lbl").innerHTML = "<i class=\"fa fa-circle\" style=\"color: #7194b2;\"></i> ";
                document.getElementById("StatusMode_lbl").style.color = "#7194b2";
            }

            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", filename, false);
            rawFile.onreadystatechange = function() {
                if (rawFile.readyState === 4) {
                    if (rawFile.status === 200 || rawFile.status == 0) {
                        var allText = rawFile.responseText;
                        var output_string = allText.toString().split("\n");
                        localStorage.setItem("startdate", output_string[0].split(" - ")[1].trim());
                        localStorage.setItem("enddate", output_string[1].split(" - ")[1].trim());
                        localStorage.setItem("dateval", output_string);
                    }
                }
            }
            rawFile.send(null);
        }

        // function to list of imperatives and bind into tab field
        function fetchImperatives(evt, imp_name) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(imp_name).style.display = "block";
            evt.currentTarget.className += " active";
            if (imp_name == "UsageVsFailure") {
                displayUsageDetails();
            } else if (imp_name == "dataCombination") {

                DataCombination();
            } else {
                get_behaviorPattern();
            }
        }

        var span = document.getElementsByClassName("close")[0];
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            document.getElementById('myModal').style.display = "none";
        }

        // function to get list of userid from the log file using Start and end time
        function getSearchValue() {
            if (document.getElementById("Txt_search").value.trim() == "") {
                alert("Please enter 'Search Key'");
                return false;
            } else {
                if (sessionStorage.getItem("isOnline") == "true") {
					if(localStorage.getItem("online_tp") == "true")
					{
						if (sessionStorage.getItem("TP_enddate") != "" && sessionStorage.getItem("TP_startdate") != "" && sessionStorage.getItem("TP_enddate") != null && sessionStorage.getItem("TP_startdate") != null) {
							var xhttp = new XMLHttpRequest();
							var fd = new FormData();
							fd.append("user_id", "empty");
							fd.append("rep_id", "empty");
							fd.append("report_name", "empty");
							fd.append("function_name", "pullDataFromES");
							fd.append("app_name", localStorage.getItem("ipm_appname"));
							fd.append("uploaded_filename", "empty");
							fd.append("mode", "empty");
							fd.append("Imp_id", "empty");
							fd.append("observation", "empty");
							fd.append("imp_name", "empty");
							fd.append("start_date", sessionStorage.getItem("TP_startdate"));
							fd.append("end_date", sessionStorage.getItem("TP_enddate"));
							fd.append("search_key", document.getElementById("Txt_search").value.trim());						
							localStorage.setItem("search_value", document.getElementById("Txt_search").value.trim());
							xhttp.onreadystatechange = function() {
								if (this.readyState == 4 && this.status == 200) {
									var response_list = this.responseText.split("\n");								
									document.getElementById("defaultOpen").disabled = false;
									document.getElementById("defaultOpen").click();
									displayUsageDetails();
									for (var rep_i=0; rep_i<response_list.length-1 ; rep_i=rep_i+1)
									{
										if(response_list[rep_i].trim().split(" - ")[0].toString().includes("Unique service"))
										{
											var service_list_arr = (response_list[rep_i].toString().trim().split(" - ")[1]).split("'");
											var key_drp = document.getElementById("key_drp");
											var test_length = key_drp.options.length;
											for (i = 0; i < test_length; i++) {
												key_drp.options[0] = null;
											}
											for (var ser_i = 1; ser_i < service_list_arr.length-1; ser_i = ser_i + 2) {
												var option = document.createElement("option");
												if(service_list_arr[ser_i] != "Usage")
												{
													option.text = service_list_arr[ser_i];
													key_drp.add(option, key_drp[0]);
												}
											}
												
										}
									}
									alert(response_txt);
								}
							};
							xhttp.open("POST", "../cgi-bin/Decrypt_PyFile.py", true);
							xhttp.send(fd);
						}
					} else {
                        alert("Please select date range from datepicker");
                    }
                } else {
                    var xhttp = new XMLHttpRequest();
                    var fd = new FormData();
                    var testname = localStorage.getItem("testname");
                    var sdate = moment($('#start_datepicker').val()).format('MM/DD/YY HH:mm');
                    localStorage.setItem("startdate", sdate);
                    var edate = moment($('#end_datepicker').val()).format('MM/DD/YY HH:mm');
                    var txt_value = document.getElementById("Txt_search").value;
					console.log("TEstIPM #527",txt_value);
                    fd.append("user_id", localStorage.getItem("ipm_UserId"));
                    fd.append("rep_id", localStorage.getItem("rep_id"));
                    fd.append("report_name", localStorage.getItem("reportname"));
                    fd.append("function_name", "IMP008Drilldown");
                    fd.append("app_name", localStorage.getItem("ipm_appname"));
                    fd.append("uploaded_filename", localStorage.getItem("logtype_filename"));
                    fd.append("mode", "OFL");
                    fd.append("Imp_id", "empty");
                    fd.append("observation", "empty");
                    fd.append("imp_name", sessionStorage.getItem("Imperative_name"));
                    fd.append("start_date", sdate);
                    fd.append("end_date", edate);
                    fd.append("search_key", txt_value);
                    localStorage.setItem("search_value", txt_value);
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            if (this.responseText.toString() != "") {
                                var unique_key_list = this.responseText.toString().split("\n"); 
                                var service_list_arr = unique_key_list[0].split("'");
                                var key_drp = document.getElementById("key_drp");
                                var test_length = key_drp.options.length;
                                for (i = 0; i < test_length; i++) {
                                    key_drp.options[0] = null;
                                }
                                for (var ser_i = 1; ser_i < service_list_arr.length; ser_i = ser_i + 2) {
                                    var option = document.createElement("option");
                                    option.text = service_list_arr[ser_i];
                                    key_drp.add(option, key_drp[0]);
                                }
                                console.log(unique_key_list);
                                var divlink = document.getElementById("Div_Keys");
                                localStorage.setItem("startdate", sdate);
                                localStorage.setItem("enddate", edate);
                                search_node_arr = unique_key_list[1].split("'");
								console.log("TEstIPM #561",sdate);
                                if (search_node_arr.length > 3) {
									console.log("TEstIPM #563");
                                    for (var div_i = divlink.childNodes.length - 1; div_i > 1; div_i--) {
                                        divlink.removeChild(divlink.childNodes[div_i]);
                                    }
                                    var modal = document.getElementById('myModal');
                                    modal.style.display = "block";
                                    for (var key_i = 1; key_i < search_node_arr.length; key_i = key_i + 2) {
                                        var label = document.createElement("label");
                                        var radio = document.createElement("input");
                                        radio.type = "radio";
                                        radio.name = "Key";
                                        radio.value = search_node_arr[key_i];
                                        label.appendChild(radio);
                                        radio.style.marginRight = "10px";
                                        label.style.marginLeft = "10px";

                                        label.appendChild(document.createTextNode(search_node_arr[key_i]));
                                        document.getElementById("Div_Keys").appendChild(label);

                                        var space3 = document.createElement('br');
                                        document.getElementById("Div_Keys").appendChild(space3);
                                        var space4 = document.createElement('br');
                                        document.getElementById("Div_Keys").appendChild(space4);
                                    }
                                    var proceed_btn = document.createElement("button");
                                    proceed_btn.innerHTML = "Proceed";
                                    proceed_btn.style.marginLeft = "5%";
                                    document.getElementById("Div_Keys").appendChild(proceed_btn)
                                    proceed_btn.setAttribute('onclick', 'getRadioValue();');
                                } else {
                                    if (search_node_arr.length > 1) {
                                        localStorage.setItem("Key", search_node_arr[1]);
                                        document.getElementById('myModal').style.display = "none";
                                        document.getElementById("defaultOpen").disabled = false;
                                        document.getElementById("Btn_dc").disabled = false;
                                        //document.getElementById("Btn_bp").disabled = false;
                                        document.getElementById("defaultOpen").click();
                                        displayUsageDetails();
                                    } else {
                                        alert("Please provide valid 'Search' key");
                                    }

                                }
                            } else {
                                var unique_key_list = this.responseText.toString().split("\n");
                                document.getElementById("defaultOpen").click();
                                $("#Rollview").empty();
                                $("#tbl_usage").empty();
                                $("#drilldown_tbl").empty();
                                $("#bp_tbl").empty();
                                document.getElementById("defaultOpen").disabled = true;
                                document.getElementById("Btn_dc").disabled = true;
                                //document.getElementById("Btn_bp").disabled = true;
                            }
                        }
                    };
                    xhttp.open("POST", "../cgi-bin/Decrypt_PyFile.py", true);
                    xhttp.send(fd);
                }
            }
        }
        // function to get key value from pop-up box
        function getRadioValue() {
            if ($("input[name='Key']:checked").val() != "" && $("input[name='Key']:checked").val() != null) {
                localStorage.setItem("Key", $("input[name='Key']:checked").val());
                document.getElementById('myModal').style.display = "none";
                document.getElementById("defaultOpen").disabled = false;
                document.getElementById("Btn_dc").disabled = false;
                //document.getElementById("Btn_bp").disabled = false;
                document.getElementById("defaultOpen").click();
                displayUsageDetails();
            } else {
                alert("Select a Value before proceed");
            }
        }

        // function to display usage and failure details in Usage vs Failure tab
        function displayUsageDetails() {
            localStorage.setItem("imp_tab", "Usage");
            document.getElementById("defaultOpen").disabled = false;
            var file_name = "";
            var filename = "";
            var current_date =  new  Date().getFullYear() + '-' + ("0" + (new  Date().getMonth() + 1)).slice(-2) + '-' + ("0" + new  Date().getDate()).slice(-2);
            var report_path = "";
            if (sessionStorage.getItem("isOnline") == "true") {
                document.getElementById("StatusMode_lbl").innerHTML = "<i class=\"fa fa-circle\" style=\"color: green;\"></i> ";
                document.getElementById("StatusMode_lbl").style.color = "green";
                file_name = localStorage.getItem("ipm_appname") + "_" + sessionStorage.getItem("Imperative_name");
                if (localStorage.getItem("search_value") == "") {
                    if (localStorage.getItem("online_tp") == "false") {
                        filename = "online/" + file_name + "_ONL_Usage_" + current_date + ".csv";
                    } else {
                        filename = "online/" + file_name + "_TP_Usage_" + current_date + ".csv";
                    }
                } else {
                    if (localStorage.getItem("online_tp") == "false") {
                        filename = "online/" + file_name + "_ONL_" + localStorage.getItem("search_value") + "_" + current_date + ".csv";
                    } else {
                        filename = "online/" + file_name + "_TP_" + localStorage.getItem("search_value") + "_" + current_date + ".csv";
                    }
                }
            } else {

                var log_folder = localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("rep_id");
                var file_name = localStorage.getItem("ipm_appname") + "_" + localStorage.getItem("reportname").toLowerCase() + "_" + sessionStorage.getItem("Imperative_name");
                document.getElementById("StatusMode_lbl").innerHTML = "<i class=\"fa fa-circle\" style=\"color: #7194b2;\"></i> ";
                document.getElementById("StatusMode_lbl").style.color = "#7194b2";

                if (localStorage.getItem("search_value") == "") {
                    filename = "Reports/" + log_folder + "/" + file_name + "_Usage.csv";
                } else {
                    filename = "Reports/" + log_folder + "/" + file_name + "_" + localStorage.getItem("search_value") + ".csv";
                }
            }

            //file_name = localStorage.getItem("ipm_appname") + "_" + localStorage.getItem("reportname").toLowerCase() + "_" + sessionStorage.getItem("Imperative_name");
            $("#Rollview").empty();
            $.get(filename, function(data) {
                $("#tbl_usage").empty();
                //$('table tr').not(':nth-child(1)').remove();
                var build = '<table id="tbl_usage">\n';
                var rows = data.split("\n");
                var isRole = false;
                var i = true;
                rows.forEach(function getvalues(thisRow) {
                    if (thisRow != "" && rows.length > 2) {
                        var columns = thisRow.split(",");
                        if (columns[0] == "Service Call") {
                            build += " <thead> <tr>";
                            for (var i = 0; i < columns.length; i++) {
                                build += "<th>" + columns[i] + "</th>\n";
                            }
                            build += "</tr></thead>\n <tbody> ";
                            i = false;
                        } else {
                            build += "<tr><td>" + columns[0] + "</td>"
                            for (var i = 1; i < columns.length; i++) {
                                build += "<td>" + columns[i] + "</td>";
                            }
                            build += "</tr>\n";

                        }
                    }
                })
                build += "</tbody></table>";
                //$('#tbl_usage').DataTable().order([0, 'asc']);
                $('#Rollview').append(build);
            });
        }

        // function to read given file and return data
        function readTextFile(file, callback) {
            var rawFile = new XMLHttpRequest();
            rawFile.overrideMimeType("application/json");
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function() {
                if (rawFile.readyState === 4 && rawFile.status == "200") {
                    callback(rawFile.responseText);
                }
            }
            rawFile.send(null);
        }

        // function to call the usage data python 
        function DataCombination() {
            localStorage.setItem("imp_tab", "DataCombination");
            var key_drp = document.getElementById('key_drp');
            var service_name = key_drp.options[key_drp.selectedIndex].text;
            localStorage.setItem("serviceCall_selectedItem", key_drp.options[key_drp.selectedIndex].text);

            var file_name = "";
            var filename = "";
            var current_date =  new  Date().getFullYear() + '-' + ("0" + (new  Date().getMonth() + 1)).slice(-2) + '-' + ("0" + new  Date().getDate()).slice(-2);
            if (sessionStorage.getItem("isOnline") == "true") {
                file_name = localStorage.getItem("ipm_appname") + "_" + sessionStorage.getItem("Imperative_name");
                if (localStorage.getItem("search_value") == "") {
                    if (localStorage.getItem("online_tp") == "false") {
                        filename = "online/" + file_name + "_ONL_" + localStorage.getItem("serviceCall_selectedItem") + "_" + current_date + ".csv";
                    } else {
                        filename = "online/" + file_name + "_TP_" + localStorage.getItem("serviceCall_selectedItem") + "_" + current_date + ".csv";
                    }
                } else {
                    if (localStorage.getItem("online_tp") == "false") {
                        filename = "online/" + file_name + "_ONL_" + localStorage.getItem("serviceCall_selectedItem") + "_" + localStorage.getItem("search_value") + "_" + current_date + ".csv";
                    } else {
                        filename = "online/" + file_name + "_TP_" + localStorage.getItem("serviceCall_selectedItem") + "_" + localStorage.getItem("search_value") + "_" + current_date + ".csv";
                    }
                }
            } else {

                var log_folder = localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("rep_id");
                var file_name = localStorage.getItem("ipm_appname") + "_" + localStorage.getItem("reportname").toLowerCase() + "_" + sessionStorage.getItem("Imperative_name");

                if (localStorage.getItem("search_value") == "") {
                    filename = "Reports/" + log_folder + "/" + file_name + "_" + localStorage.getItem("serviceCall_selectedItem") + "_DC.csv";
                } else {
                    filename = "Reports/" + log_folder + "/" + file_name + "_" + localStorage.getItem("serviceCall_selectedItem") + "_" + localStorage.getItem("search_value")+ ".csv";
                }
            }
            //var file_name = localStorage.getItem("ipm_appname") + "_" + localStorage.getItem("reportname").toLowerCase() + "_" + sessionStorage.getItem("Imperative_name") + "_" + localStorage.getItem("serviceCall_selectedItem");
            $("#Rollview").empty();
            readTextFile(filename, function(text) {
                var row_arr = text.split('\n');
                var drilltbl = document.getElementById("drilldown_tbl");
                var rowCount = drilltbl.rows.length;
                var tableHeaderRowCount = 0;
                for (var x = tableHeaderRowCount; x < rowCount; x++) {
                    drilltbl.deleteRow(tableHeaderRowCount);
                }
                /*for (var row_i = 0; row_i < row_arr.length - 1; row_i++) {
                    var col_arr = row_arr[row_i].split(',');
                    var lastRow = drilltbl.rows.length;
                    var header = "";
                    var row = "";
                    row = drilltbl.insertRow(lastRow);

                    for (var col_i = 0; col_i < col_arr.length; col_i++) {
                        if (row_i == 0) {
                            drilltbl.rows[0].style.backgroundColor = "#365890";
                            drilltbl.rows[0].style.color = "#FFFFFF";
                        }
                        var cell = row.insertCell(col_i);
                        cell.innerHTML = col_arr[col_i];
                    }
                    drilltbl.appendChild(row);
                }*/
				var col_val = 0;
                for(var row_i=0; row_i < row_arr.length-1; row_i++)
                {
                   var col_arr = row_arr[row_i].split(',');
                   var lastRow = drilltbl.rows.length;
                   var header = "";
                   var row = "";
                   row = drilltbl.insertRow(lastRow);
 
                   var status_id = 0;
                   
                   for (var col_i=0; col_i < col_arr.length+1; col_i++)
                   {
                      if(row_i==0)
                      {
                         drilltbl.rows[0].style.backgroundColor = "#365890";
                         drilltbl.rows[0].style.color = "#FFFFFF";
                      }                                                                          
                      if(row_i==0 && col_i == 0)
                      {                                                           
                         var cell = row.insertCell(0);
                         cell.innerHTML = "S.No";
                      }
                      else if(col_i == 0 && row_i!=0)
                      {
                         var cell = row.insertCell(0);
                         cell.innerHTML = col_val;
                      }
                      else{
                         if(row_i==0)
                         {
                                        if(col_arr[col_i-1] == "Status")
                                        {
                                                       status_id = col_i-1;
                                        }
                         }
                         var cell = row.insertCell(col_i);                                                                
                         cell.innerHTML = col_arr[col_i-1];
                         if(status_id == (col_i-1))
                         {
                                if(col_arr[col_i-1] == "Pass")
                                {
                                               cell.style.color = "#008000";
                                }
                                else if(col_arr[col_i-1] == "Fail")
                                {
                                               cell.style.color = "#FF0000";
                                }
                         }
                      }
                   }
                   col_val++;
                   drilltbl.appendChild(row);
				}
            });
        }
    </script>
</body>

</html>