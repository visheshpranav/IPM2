<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>JaCoCo</title>
    <script type="text/javascript" src="../JScript/d3.v6.min.js"></script>
    <link rel="stylesheet" href="../style/Main2.css">
      <link rel="stylesheet" href="../styles/font-awesome/css/font-awesome.min.css">
    <!-- We use google fonts for many of the examples, but they are not necessary -->
    <link href='../styles/googleapis_Roboto.css' rel='stylesheet' type='text/css'>
	<script type="text/javascript" src="../JScript/d3.v6.min.js"></script>
    <link rel="stylesheet" href="../style/Main2.css">
    <!-- Test container style sheets -->
    

    <!-- Vizuly specific style sheets -->
    <link rel="stylesheet" href="../styles/vizuly.css">
    <!-- <link rel="stylesheet" href="../styles/vizuly_weightedtree1.css"> -->
	<link rel="stylesheet" href="../styles/vizuly_weightedtree.css">

    <!-- Supporting test container files:  Vizuly does NOT rely on these -->
    <link href="../styles/googleapis_materialicon.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles/cssmenu.css">
	<script type="text/javascript" src="../JScript/treeview.js"></script>
    <script type="text/javascript" src="../JScript/jquery-2.1.1.min.js"></script>
    <script src="../JScript/cssmenu.js"></script>
	<script src="../JScript/Lapam.js"></script>
    <!-- D3.js ... of course! -->
    <script src="../JScript/d3.min.js"></script>
	
	<style>
	svg {
    border: solid;
	
}
.loader {
    position: fixed;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    z-index: 9999;
    background: url('../images/loader.gif') 50% 50% no-repeat rgb(249,249,249);
	}
	
	</style>
	
	
	
	
	
</head>
<body onload="DmReport(),DmReport2(),Columnames()"> <!-- onload= "DmReport()"> -->
    <!-- <div class="fixed-header">
       <div class="container">THE View - Code Coverage</div>         
    </div> -->
	<div class="loader" style="display:none">Loading Reports!.......</div>
	<button class="btnn" id="expand_button" onclick="expandall()" style="float:right; width:7.5%; min-width: 75px; margin-left: 10%; margin-top: 12px; position: absolute;"><i class="fa fa-expand" style="padding-right:5px;float:left; "></i> Expand</button>
    <button class="btnn" id="collapse_button" onclick="collapseall()" style="float:right; width:8%; min-width: 85px; margin-left: 20px; margin-top: 12px;  position: absolute;"><i class="fa fa-compress" style="padding-right:5px;float:left; "></i>  Collapse</button>
    <div id="chart" style="float:left; width:50%;margin-top:3%; " >


<div id="filter_div" style="float: right; margin-right:-620px; width: 32%;height: 78%; border: solid; overflow: hidden">
		<div style="left: 0; right: 0; top: 0; bottom: 0; margin: auto; width: 99%;">
		<button class="btnn" id="rearr2" onclick="javascript:void(0);" style="float:left; margin:2%; width: 44%;background-color: grey; margin-left: 4%"><i class="fa fa-download" style="padding-right:5px;float:left; "></i> Filter Download </button>
		<button class="btnn" id="dfault" onclick="javascript:clickDownload();" style="float:left; margin:2%;width: 44%;"><i class="fa fa-download" style="padding-right:5px; float: left;"></i>  Master data</button> 
		</div>
		<br/><br/>
	<!--<label id="filter_lbl" style="margin-left: 2%; margin-top: 50px;">Filtered Data: </label>
	<select id="slt_filter_trade" onchange="bindFilterdata()" style="border-radius: 10px;width: 120px;border: solid; border-width: thin; padding-left: 5px;" disabled>
		</select><br/><br/>-->
		<br><br>
		<div style="left: 0; right: 0; top: 0; bottom: 0; margin: auto; width: 95%;">
	   <label id="trade_lbl" style="margin-left: 4%; width: 30%; margin-top: 15px; float: left;font-size:14px; margin-right:5px;">Headers: </label>
	   <select id="slt_trade" onchange="callvalues()" style="border-radius: 5px;width: 60%;border: solid; border-width: thin; padding-left: 5px;margin-top: 15px; margin-left: 1%; font-family: AccentureRotis,Arial,sans-serif;">
		</select>
		</div>
		<br><br><br>
		<div style="left: 0; right: 0; top: 0; bottom: 0; margin: auto; width: 95%;">
	   <label id="trade_lbl" style="margin-left: 4%; width: 30%; margin-top: 15px; float: left;font-size:14px; margin-right:5px;">Values: </label>
	   <select id="slt_trade2" onchange="dendovalues()" style="border-radius: 5px;width: 60%;border: solid; border-width: thin; padding-left: 5px;margin-top: 15px; margin-left: 1%; font-family: AccentureRotis,Arial,sans-serif;">
		</select>
		</div>
	 
	<!-- <div id="header_div" style="left: 0; right: 0; top: 0; bottom: 0; margin: 10px; margin-top: 20px; width: 95%; height: 130px;">
		<label class="list-heading" id="CompareTest_lbl" hidden>Trade characteristics </label><br><br/>
		<select multiple="multiple" id='lstBox1' hidden></select>
	</div>
	<br><br/>
	<div id="header_div" style="margin-left: 4%; left: 0; right: 0; top: 0; bottom: 0; margin: 10px; margin-top: 5px; width: 95%;"><!--class="subject-info-arrows text-center"-->
	<!-- <input type='button' id='btnAllRight' data-toggle="tooltip" data-placement=">>" title="Click to move all items to down" value='>>' class="btn btn-default" />
	<input type='button' id='btnRight' data-toggle="tooltip" data-placement=">" title="Click to move selected items to down" value='>' class="btn btn-default" />
	<input type='button' id='btnLeft' data-toggle="tooltip" data-placement="<" title="Click to move selected items to top" value='<' class="btn btn-default" />
	<input type='button' id='btnAllLeft' data-toggle="tooltip" data-placement="<<" title="Click to move all items to top" value='<<' class="btn btn-default" />-->
	<!-- </div>
	<br><br/>
	<div id="header_div" style="margin-left: 4%;left: 0; right: 0; top: 0; bottom: 0; margin: 10px; margin-top: 5px;  width: 95%; height: 130px;">
	  <label class="list-heading" id="CompareTest_lbl1" hidden>Trade characteristics order </label><br><br/>
	  <select multiple="multiple" id='lstBox2' hidden></select></br>
	  <!-- <label style="float: left; font-size: 12px; margin-left: 40px; margin-top: 5px; width: 250px;">The above characteristics order will position the top node as parent for the immediate next node</label></br>
	</div>   -->
	<br><br><br><br><br><br><br><br><br><br>
	<div style="width:100%; float: left; margin-top: 100px; text-align: center;">
	<!--<input type="button" value="View Master data" id ="master_bf" class="btn_compare" onclick="masterCsv();">-->
	<!-- 	<button class="btnn" id="expand_button" onclick="expandall()" style="float:right; width:7.5%; min-width: 75px; margin-left: 10%; margin-top: 12px; position: absolute;"><i class="fa fa-expand" style="padding-right:5px;float:left; "></i> Expand</button>
    <button class="btnn" id="collapse_button" onclick="collapseall()" style="float:right; width:8%; min-width: 85px; margin-left: 20px; margin-top: 12px;  position: absolute;"><i class="fa fa-compress" style="padding-right:5px;float:left; "></i>  Collapse</button> -->

	<input type="button" value="View Filter" id ="Getdendo" class="btn_compare" style="margin: 2%; background-color:grey; " onclick="readMasterCSV2(); "disabled>
	<input type="button" value="View Master" id ="Getdendo2" class="btn_compare" style="margin: 2%; background-color:blue; " onclick="readMasterCSV4(); ">
	</div>
	</br>
</div>
<script type="text/javascript" src="../JScript/treeview.js"></script>
</div>
  </body>
  
<script>


function DmReport(){
	showLoader();
	var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname")
	var filename = "Reports/"+foldername+"/datamart_output.json";
	var http = new XMLHttpRequest();
	http.open('HEAD', filename, false);
    http.send();
	if (http.status === 200){
    loadata(filename);
	hideLoader();
	}
	else
	{
  	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("report_name",localStorage.getItem("reportname"));
	fd.append("app_name",localStorage.getItem("ipm_appname"));
	txtFile.open("POST", "../cgi-bin/murex_datamart_log.py",true);
	
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			alert(allText);
			loadata(filename);
			setTimeout(function(){
			hideLoader();
			location.reload();
			}, 16000);
			

			}			
		};
	txtFile.send(fd);
	}
	}
	
function DmReport2(){
	showLoader();
	var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname")
	var filename = "Reports/"+foldername+"/Week.json";
	var http = new XMLHttpRequest();
	http.open('HEAD', filename, false);
    http.send();
	if (http.status === 200){
    //loadata(filename);
	hideLoader();
	}
	else
	{
  	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("report_name",localStorage.getItem("reportname"));
	fd.append("app_name",localStorage.getItem("ipm_appname"));
	txtFile.open("POST", "../cgi-bin/murex_datamart_chart.py",true);
	
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			//alert(allText);

			

			}			
		};
	txtFile.send(fd);
	}
	}
	


	

function Columnames(){
	document.getElementById("slt_trade2").innerHTML = "";
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("report_name",localStorage.getItem("reportname"));
	fd.append("app_name",localStorage.getItem("ipm_appname"));
	txtFile.open("POST", "../cgi-bin/list_of_columns.py",true);
	
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			myfunction(allText);
			}			
		};
	txtFile.send(fd);
	}
	
	function myfunction(colnam){
	
	var opt= colnam.toString().replace(/[&\\\#+()$~%.'":*?<>{}]/g, '')
	opt2=opt.replace(/[\[\]']+/g,'');
	var optionValues = opt2.split(',');
        for (var i=0;i<optionValues.length;i++){
            jQuery('#slt_trade').append(jQuery("<option></option>").val(optionValues[i]).text(optionValues[i]))
        }
		jQuery('#slt_trade').append(jQuery("<option disabled selected value> -- select -- </option>"))
		SortOptions("#slt_trade");
    	
	}
	
	
	function SortOptions(id) {
    var prePrepend = "#";
    if (id.match("^#") == "#") prePrepend = "";
    $(prePrepend + id).html($(prePrepend + id + " option").sort(
        function (a, b) { return a.text == b.text ? 0 : a.text < b.text ? -1 : 1 })
    );
}
	
	function clickDownload(){
		var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname")	
		var filename = "Reports/"+foldername+"/"+"Datamart_output.csv";
		window.open(filename, '_blank');
	}
	
	function clickRearrangeDownload2(){
	
	var t = document.getElementById("slt_trade2").value.trim();	
	var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname");
	
	var p= localStorage.getItem("column_name");
	var k= p.includes("/");
	if (k)
	{
	var res = p.replaceAll("/", "_");
	}
	else
	{
	res = p;
	}
	
	filename="../html/Reports/"+foldername+"/"+res+"_"+t+".csv";
	window.open(filename, '_blank');
	}
	
	
	function callvalues(){
	document.getElementById("slt_trade2").innerHTML = "";
	var t = document.getElementById("slt_trade").value.trim();
	localStorage.setItem("column_name",t);
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("column_name",t)
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("report_name",localStorage.getItem("reportname"));
	fd.append("app_name",localStorage.getItem("ipm_appname"));
	txtFile.open("POST", "../cgi-bin/datamart_unique_values.py",true);
	
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			myfunction2(allText);
			}			
		};
	txtFile.send(fd);
	
	
	}
	
	function myfunction2(colnam){
	var opt= colnam.toString().replace(/[&\/\\#+()$~%'":*?<>{}]/g, '')
	opt2=opt.replace(/[\[\]']+/g,'');
	var optionValues = opt2.split(',');
        for (var i=0;i<optionValues.length;i++){
            jQuery('#slt_trade2').append(jQuery("<option></option>").val(optionValues[i]).text(optionValues[i]))
        }
		jQuery('#slt_trade2').append(jQuery("<option disabled selected value> -- select an option -- </option>"))
		SortOptions("#slt_trade2");
    	
	}
	
	function showLoader()
	{
    $(".loader").fadeIn("slow");	
	}
	function hideLoader()
	{
    $(".loader").fadeOut("slow");
	}


function readMasterCSV4()
	{	
location.reload();
}

function readMasterCSV2()
	{	
	//d3.selectAll("svg > *").remove();
	document.getElementById("chart").value= "";
	var t = document.getElementById("slt_trade2").value.trim();	
	var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname");
	
	var p= localStorage.getItem("column_name");
	var k= p.includes("/");
	if (k)
	{
	var res = p.replaceAll("/", "_");
	}
	else
	{
	res = p;
	}
	
	loadata("../html/Reports/"+foldername+"/"+res+"_"+t+".json");
	$("#rearr2").attr("onclick", "javascript:clickRearrangeDownload2();");
	document.getElementById("rearr2").style.backgroundColor = "DodgerBlue";
	
	}
	
function dendovalues(){
	
	var t = document.getElementById("slt_trade2").value.trim();
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("column_name",localStorage.getItem("column_name"));
	fd.append("unique_value",t)
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("report_name",localStorage.getItem("reportname"));
	fd.append("app_name",localStorage.getItem("ipm_appname"));
	txtFile.open("POST", "../cgi-bin/datamart_output_filter.py",true);
	
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			}			
		};
	txtFile.send(fd);
	document.getElementById("Getdendo").disabled = false;
	document.getElementById('Getdendo').style.backgroundColor = 'blue';
	}

</script>
  
  
  
  
</html>

