<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>OSP Queue Order</title>
	<link rel="stylesheet" href="../styles/font-awesome/css/font-awesome.min.css">
    <!-- We use google fonts for many of the examples, but they are not necessary -->
    <link href='../styles/googleapis_Roboto.css' rel='stylesheet' type='text/css'>
	   <link href="../styles/googleapis_materialicon.css" rel="stylesheet">
	   <link href='../styles/googleapis_Roboto.css' rel='stylesheet' type='text/css'>
    <!-- Test container style sheets -->
    <link rel="stylesheet" href="../styles/examples.css">

    <!-- Vizuly specific style sheets -->
    <link rel="stylesheet" href="../styles/vizuly.css">
    <link rel="stylesheet" href="../styles/vizuly_weightedtree.css">

    <!-- Supporting test container files:  Vizuly does NOT rely on these -->
    <link href="../styles/googleapis_materialicon.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles/cssmenu.css">
    <script type="text/javascript" src="../JScript/jquery-2.1.1.min.js"></script>
    <script src="../JScript/cssmenu.js"></script>

    <!-- D3.js ... of course! -->
    <script src="../JScript/d3.min.js"></script>
    <!-- debug source scripts: end -->
  <title>HTML Reference</title>
  <style>

	
	@font-face {
	font-family: 'AccentureRotis';
	src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}

	body {
    font-family: AccentureRotis,Arial,sans-serif;
	}
  .btnn {
		background-color: DodgerBlue;
		border: none;
		color: white;
		padding: 6px 12px;
		cursor: pointer;
		font-size: 14px;
		border-radius: 15px;
		outline: none;font-family: AccentureRotis,Arial,sans-serif;
	}
h1{	margin-bottom: 0; }
		
p{margin-top: 0;}


/* Set header to stick to the top of the container. */
thead tr th {
  position: sticky;
  top: 0;
}

/* If we use border,
we must use table-collapse to avoid
a slight movement of the header row */
table {
 border-collapse: collapse;
}

/* Because we must set sticky on th,
 we have to apply background styles here
 rather than on thead */
th {
  padding: 2px;
  padding-left: 5px;
  border-left: 1px dotted rgba(200, 209, 224, 0.6);
  border-bottom: 1px solid #e8e8e8;
  background: #023e72;
  text-align: center;
  font-size: 14px;
  /* With border-collapse, we must use box-shadow or psuedo elements
  for the header borders */
  box-shadow: 0px 0px 0 2px #e8e8e8;
  color: white;
}

/* Basic Demo styling */
table {
  width: 93%;
  font-family: AccentureRotis,Arial,sans-serif;
}
table td {
  padding: 2px;
	font-size: 12px;
}
tbody tr {
  border-bottom: 2px solid #e8e8e8;
}
thead {
  font-size: 14px;
  color: rgba(0, 0, 0, 0.85);
  text-align: center;
}
tbody tr:hover {
  background: #e6f7ff;
}
.loader {
    position: fixed;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    z-index: 9999;
    background: url('../images/loader.gif') 50% 50% no-repeat rgb(249,249,249);
	}

</style>
<script src="../JScript/vizuly_core.min.js"></script>
<script src="../JScript/OSP_vizuly_weightedtree.min.js"></script>
<script src="../JScript/OSPWF.js"></script>
</head>
<body>
<div id='cssmenu'>
    <ul class="main-menu">
        <li class='active'>
            <a><span>Display</span><br><span class="setting"></span></a>
            <!--ul class="options"-->
                <li id="currentDisplay"></li>
            <!--/ul-->

        </li>
    </ul>
</div>
<div class="loader" style="display:none">Loading Reports!.......</div>
    <button class="btnn" id="expand_button" onclick="expandall();hidetable();" style="float:right; width:7.5%; min-width: 75px; margin-left: 10%; margin-top: 12px; position: absolute;"><i class="fa fa-expand" style="padding-right:5px;float:left; "></i> Expand</button>
    <button class="btnn" id="collapse_button" onclick="collapseall();hidetable();" style="float:right; width:8%; min-width: 85px; margin-left: 20px; margin-top: 12px;  position: absolute;"><i class="fa fa-compress" style="padding-right:5px;float:left; "></i> Collapse</button>
	<button class="btnn" id="Download_Workstream" onclick="clickDownload();" style="float:right; margin:5px; margin-left: 86%; margin-top: 12px;  position: absolute;"><i class="fa fa-download"></i> Download</button>
    <div id="viz_container" style="float: left; width: 100%;height: 75%; border: solid; margin: 5px; overflow:scroll; padding-top: 80px;">
	<!-- <input type="radio" style="margin-left: 35%;" id="wk_RCA" onclick="radio_RCA(this);" name="Deviation" value="0" checked /><i id="check_box1" >Deviation Across WorkStreams</i>
		<input type="radio" id="ly_RCA" onclick="radio_RCA(this);" name="Deviation" value="1"/><i id="check_box2" >Deviation Across Layers</i> -->
			
 
<!-- <a href="#" onclick="clickDownload()" id ="Download_Workstream" ><img src="../images/Download.png"  style="color:black; width: 48px; height: 30px; margin-top: 20px; margin-right: 30px; float: right;" ></a> -->
	</div>
	<div id="OSP_tblcontent" class="component" style="width: 20%; float: left; margin-left: -25%; margin-top: 10%; display: none;">
	<!-- <h1 id="Lbl_hdr" style="color:black; font-size:14px; font-weight:bold; font-family: AccentureRotis,Arial,sans-serif; margin-left: 1%; text-decoration: underline; margin-bottom: 10px;"></h1> -->
	</div>

<script>
		function getQueryStrings() {
		  var StrVal  = {};
		  var decode = function (s) { return decodeURIComponent(s.replace(/\+/g, " ")); };
		  var queryString = location.search.substring(1);
		  var keyValues = queryString.split('&');

		  for(var i in keyValues) {
			var key = keyValues[i].split('=');
			if (key.length > 1) {
			  StrVal[decode(key[0])] = decode(key[1]);
			}
		  }
		  return StrVal;
		}

		var qs = getQueryStrings();
		var qs_size = Object.keys(qs).length;
		if(qs_size > 1)
		{
			localStorage.setItem("testname",qs["testname"]);
		}

    //Once the document is ready we set javascript and page settings
    var screenWidth;
    var screenHeight;
	/*var testname = localStorage.getItem("testname").toLowerCase();
	var userid = localStorage.getItem("UserId");
	var prjid = localStorage.getItem("PrjId");
	test_log = userid + "_"+prjid+"_"+testname;*/
	var filename = "../html/Reports/RCAWorkStreamChart.csv";
	var filename1 = "../html/Reports/OSP_Queue_Traversal.csv";
  
	var CSVToArray = function CSVToArray(data) {
		var delimiter =
			arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ",";
		var omitFirstRow =
			arguments.length > 2 && arguments[2] !== undefined
				? arguments[2]
				: false;
	 
		return data
			.slice(omitFirstRow ? data.indexOf("\n") + 1 : 0)
			.split("\n")
			.map(function(v) {
				return v.split(delimiter);
			});
	};
	
	var csvArray = []
	
	getUniqueTradeCount();
	//getUniqueType();
	var master_unique = [];
	var master_type_unique = [];
	var master_counts = {};
	
	function getUniqueType(){
		file = "Reports\\"+foldername+"\\OSP_master_queue.csv"
		$.get(file, function(data) 
		{
			var rows = data.split("\n");
			if(rows.length > 1)
			{
				rows.forEach( function getvalues(thisRow) 
				{
					if(thisRow != "")
					{				
						var columns = thisRow.split(",");
						for(var i=2;i<columns.length-1;i++){							
							if(i != columns.length)
							{
								if(i == 3 && columns[2] === "Contractid")
								{
									contract_count = columns[i].split(';');
									master_type_unique[columns[0]] = contract_count.length.toString();
									break;
								}
							}
						}
					}
				})
			}	
		});
	}
	function getUniqueTradeCount()
	{
		showLoader();
		var txtFile = new XMLHttpRequest();
		var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname");
		txtFile.open("GET", "../html/Reports/"+foldername+"/OSP_Typology.csv", true);
		txtFile.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200)
			{
				mastercsvArray = CSVToArray(this.responseText);
				console.log(mastercsvArray);
				for( let hdr_i = 1; hdr_i < mastercsvArray.length; hdr_i++ ){
                    master_unique[mastercsvArray[hdr_i][0]] = mastercsvArray[hdr_i][1];
                }
				//unique[mastercsvArray[5]] = 1;
				/*var master_trdhdr_value = "";
				var master_typhdr_value = "";
				for( let hdr_i = 0; hdr_i < mastercsvArray[0].length; hdr_i++ ){
					if(mastercsvArray[0][hdr_i].trim() === "Contractid"){
						master_trdhdr_value = hdr_i;	
					}
					else if(mastercsvArray[0][hdr_i].trim() === "tradeTypology"){
						master_typhdr_value = hdr_i;	
					}
				}
				for( let csv_i = 1; csv_i < mastercsvArray.length; csv_i++ ){
					if(mastercsvArray[csv_i][master_typhdr_value] != "")
					{
						master_counts[mastercsvArray[csv_i][master_typhdr_value] +"__"+mastercsvArray[csv_i][master_trdhdr_value]] = 1 + (master_counts[mastercsvArray[csv_i][master_typhdr_value] +"__"+mastercsvArray[csv_i][master_trdhdr_value]] || 0);
						
					}
				}
				for (var key in master_counts){
				  master_unique[key.split("__")[0]] = 1 + (master_unique[key.split("__")[0]] || 0)
				} 
				console.log(master_counts)
				console.log(master_unique)*/
			}
			hideLoader();
			
		};
		txtFile.send();
	}

    $(document).ready(function () {

        var rect;
        if (self==top) {
            rect = document.body.getBoundingClientRect();
        }
        else {
            rect =  parent.document.body.getBoundingClientRect();
        }

        //Set display size based on window size.
        screenWidth = (rect.width < 960) ? Math.round(rect.width*.97) : Math.round((rect.width - 10) *.97);
		screenHeight=Math.round((window.innerHeight) *.84);
        //screenHeight=590;

        d3.select("#currentDisplay")
                .attr("item_value", (String(screenWidth) + "," + String(screenHeight)))
                .attr("class", "selected")
                .html("<a>" + screenWidth + "px - " + screenHeight + "px</a>");


        $("#cssmenu").menumaker({
            title: "FAULT MODEL",
            format: "multitoggle"
			//text-align: "center";
        });

        // Set the size of our container element.
        viz_container = d3.selectAll("#viz_container")
                .style("width", screenWidth + "px")
                .style("height", screenHeight + "px");

        loadData();

    });
	
	
	
	function showLoader()
	{
    $(".loader").fadeIn("slow");	
	}
	function hideLoader()
	{
    $(".loader").fadeOut("slow");
	}
	
	function gettrade2()
	{
		var txtFile = new XMLHttpRequest();
		var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname");
		txtFile.open("GET", "../html/Reports/"+foldername+"/OSP_Type_Typology.csv", true);
		txtFile.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200)
			{
				democsvArray = CSVToArray(this.responseText);
				console.log(democsvArray);
				
				}
		}
	}

	function clickDownload(){
    //document.getElementById("Download_Usageanalysis").href="../../cgi-bin/download.py?"+ localStorage.getItem("testname").toLowerCase() + "_usageptn";
	/*var reportnp= localStorage.getItem("reportname");
	master_file = "Reports\\"+foldername+"\\"+reportnp+"_OSP_Master.xlsx"
	//out_file = "Reports\\"+foldername+"\\OSP_Out.csv"
	window.open(master_file, '_blank');
	//window.open(out_file, '_blank');*/
	
	var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname")
	var reportnp= localStorage.getItem("reportname")
	var filename = "Reports\\"+foldername+"\\"+reportnp+"_OSP_Master.xlsx"
	var filename2 = "Reports/"+foldername+"/_OSP_Master.xlsx";
	var http = new XMLHttpRequest();
	http.open('HEAD', filename, false);
    http.send();
	if (http.status === 200){
    window.open(filename, '_blank');
	}
	else{
	window.open(filename2, '_blank');
	}
	
	}
	
	function bindTabledata(parentkey, key, typology_data)
	{
		var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname");	
		//var foldername= "44_osp_test9"
		file = "Reports\\"+foldername+"\\OSP_master_queue.csv"
		$.get(file, function(data) 
		{
			
			var rows = data.split("\n");
			var isRole = false;
			var i = true;
			var isDelVal = false;
			if(rows.length > 1)
			{
				var build = '<table id="tbl_osp">\n';
				rows.forEach( function getvalues(thisRow) 
				{
					if(thisRow != "")
					{				
					var columns = thisRow.split(",");
					document.getElementById("Lbl_hdr").style.display = "block";
					Lbl_hdr.innerText = parentkey + " - " + key.split("_")[0];
					if (columns[3] == "Name"){
						build +=" <thead> <tr>" ;
						for(var i=3;i<columns.length-1;i++){
							build += "<th>" + columns[i] + "</th>\n"; 
						}		
						build +="</tr></thead>\n <tbody> ";
						i = false;
					}
					else{
						if(parentkey == columns[0] && key.split("_")[0] == columns[2] && typology_data == columns[1] )
						{
						isDelVal = true;
						build += "<tr>"
						for(var i=3;i<columns.length-1;i++){
							if(i == (columns.length-2) && columns[3] != "Contractid")
							{
								var cellvalue = columns[i].split(';');
								var cellnextvalue = columns[i+1].split(';');
								var text_val="";
								for(var app_i=0; app_i<cellvalue.length;app_i++)
								{
									if(text_val == "")
									{
										text_val = cellvalue[app_i] + "(" + cellnextvalue[app_i] + ")";
									}
									else{
										text_val = text_val + "," + cellvalue[app_i] + "(" + cellnextvalue[app_i] + ")";
									}
								}
								console.log(text_val)
								build += "<td>" + text_val + "</td>"; 
							}
							else if(i != columns.length)
							{
								if(i == 4 && columns[3] === "Contractid")
								{
									contract_count = columns[i].split(';');
									build += "<td>" + contract_count.length + "</td>"; 
								}
								else{
									build += "<td>" + columns[i] + "</td>"; 
								}
							}
							//build += "<td>" + columns[i] + "</td>"; 
						}
						build += "</tr>\n";
						}
					
					}
				}})
			}
			else{
				alert("MXML is not available for this Type");
			}			
			if(!isDelVal)
			{
				var build = '<table id="tbl_osp"><tbody>\n';
				build += "<tr style='border-bottom: none;'><td>MXML is not available for this Type</td></tr>"; 
			}
			build += "</tbody></table>";
			$("table > tr:first").css("background-color", "blue"); 
			
			$('#OSP_tblcontent').append(build);	
		});
	}
	
	function hidetable()
	{
	document.getElementById("Lbl_hdr").style.display = "none";
	document.getElementById("tbl_osp").style.display = "none";
	}
	
	function bindTableTypedata(parentkey, key)
	{
		var foldername= localStorage.getItem("ipm_UserId") + "_"+ localStorage.getItem("reportname");	
		//var foldername= "44_osp_test9"
		file = "Reports\\"+foldername+"\\OSP_master_types.csv"
		$.get(file, function(data) 
		{
			
			var rows = data.split("\n");
			var isRole = false;
			var i = true;
			var isVal = false;
			if(rows.length > 1)
			{
				var build = '<table id="tbl_osp" >\n';
				rows.forEach( function getvalues(thisRow) 
				{
					if(thisRow != "")
					{				
					var columns = thisRow.split(",");
					document.getElementById("Lbl_hdr").style.display = "block";
					Lbl_hdr.innerText = parentkey + " - " + key;
					if (columns[2] == "Name"){
						build +=" <thead> <tr>" ;
						for(var i=2;i<columns.length;i++){
							build += "<th>" + columns[i] + "</th>\n"; 
						}		
						build +="</tr></thead>\n <tbody> ";
						i = false;
					}
					else{
						if(key == columns[0] && parentkey == columns[1])
						{
						isVal = true;
						build += "<tr>"
						for(var i=2;i<4;i++){
							if(i == (columns.length-1) && columns[2] != "Contractid")
							{
								var cellvalue = columns[i].split(';');								
								build += "<td>" + columns[i] + "</td>"; 
							}
							else if(i != columns.length)
							{
								if(columns[2] === "QueueName")
								{
									if(i == 2)
									{
									build += "<td>Queues</td>"; 
									}
									else if(i == 3 )
									{
									queue_count = columns.length-2;
									build += "<td>" + queue_count + "</td>"; 
									}
								}
								else if(i == 3 && columns[2] === "Contractid")
								{
									contract_count = columns[i].split(';');
									build += "<td>" + contract_count.length + "</td>"; 
								}
								else{
									build += "<td>" + columns[i] + "</td>"; 
								}
							}
							//build += "<td>" + columns[i] + "</td>"; 
						}
						build += "</tr>\n";
						}
					
					}
				}})
			}
			else{
				alert("MXML is not available for this Type");
			}
			if(!isVal)
			{
				var build = '<table id="tbl_osp"><tbody>\n';
				build += "<tr style='border-bottom: none;'><td>MXML is not available for this Type</td></tr>"; 
			}
			build += "</tbody></table>";
			$("table > tr:first").css("background-color", "blue"); 
			
			$('#OSP_tblcontent').append(build);	
		});
	}
</script>


</body>


</html>
