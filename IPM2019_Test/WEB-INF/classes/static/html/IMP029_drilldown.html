<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">		
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<link rel="stylesheet" href="../styles/font-awesome/css/font-awesome.min.css">
<!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"-->
<script src="../JScript/d3.v2.js"></script>
<script src="../JScript/d3-time-format.v2.min.js"></script>
<script src="../JScript/moment-with-locales.min.js"></script>
<link rel="stylesheet" href="../styles/bootstrap-datetimepicker.min.css">
<link rel="stylesheet" href="../styles/bootstrap.min.css">
<script src="../JScript/jquery.min.js"></script>
<script src="../JScript/bootstrap-datetimepicker.min.js"></script>
<script src="../JScript/bootstrap.min.js"></script>
<script type="text/javascript" src="../JScript/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../JScript/jquery.tablesorter.min.js"></script>
<script type="text/javascript" src="../JScript/jquery.tablesorter.widgets.js"></script>
<link rel="stylesheet" href="../styles/font-awesome/css/font-awesome.min.css">
<script src="../JScript/Lapam.js"></script>
</head>
<style>
h1{	margin-bottom: 0; }
		
p{margin-top: 0;}


/* Set header to stick to the top of the container. */
thead tr th {
  position: sticky;
  top: 0;
}

/* If we use border,
we must use table-collapse to avoid
a slight movement of the header row */
table {
 border-collapse: collapse;
}

/* Because we must set sticky on th,
 we have to apply background styles here
 rather than on thead */
th {
  padding: 2px;
  padding-left: 5px;
  border-left: 1px dotted rgba(200, 209, 224, 0.6);
  border-bottom: 1px solid #e8e8e8;
  background: #023e72;
  text-align: left;
  font-size: 14px;
  /* With border-collapse, we must use box-shadow or psuedo elements
  for the header borders */
  box-shadow: 0px 0px 0 2px #e8e8e8;
  color: white;
}

/* Basic Demo styling */
table {
  width: 99%;
  font-family: sans-serif;
}
table td {
  padding: 2px;
	font-size: 12px;
}
tbody tr {
  border-bottom: 2px solid #e8e8e8;
}
thead {
  font-size: 14px;
  color: rgba(0, 0, 0, 0.85);
  text-align: center;
}
tbody tr:hover {
  background: #e6f7ff;
}

</style>

<body onload="Tcodedetails()" style="font-size: 12px; background-color: #ffffff00;">
<label id="StatusMode_lbl" style="float: left; margin-left: 10px; width: 100%; margin-bottom: 0px;"></label>
<button onclick="goBack()" style="float: right; margin-right: 10px;">Back</button>
<a href="javascript:clickDownload();" id ="Download_Usageanalysis" ><img src="../images/Download.png"  style="color:black; width: 48px; height: 30px; margin-right: 30px; float: right;" ></a>

<div class="fixed-header">
       <!-- <div class="container"> -->
	   </br>
	    <h1 id="Lbl_hdr" style="color:black; font-size:14px; font-weight:bold; font-family: Verdana, sans-serif; margin-left: 10px;
    margin-bottom: 0px;"></h1>
</br>

	<div id="Rollview" class="component"></div>
<script>
var log_folder = localStorage.getItem("ipm_UserId") +"_"+localStorage.getItem("reportname").toLowerCase();

function clickDownload(){
	tcode_val = localStorage.getItem("tcode_val").replace(/[()#<>~|!?,\{\}\[\]\\\/]/gi, '');
	var filename = "Reports\\"+log_folder+"\\"+log_folder+"_"+tcode_val+".csv";
	window.open(filename, '_blank');
}
 // function - to attaind drilldown of Tcodes
function Tcodedetails()
{
	var xhttp = new XMLHttpRequest();	
	var fd = new FormData();
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("test_name",localStorage.getItem("reportname"));	
	fd.append("Tcode",localStorage.getItem("tcode_val"));	
	fd.append("prjid",localStorage.getItem("rep_id"));		
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			var response_txt = this.responseText.split("\n");
			var original_tcode_val = localStorage.getItem("tcode_val");
			tcode_val = decodeURIComponent(localStorage.getItem("tcode_val")).replace(/[()#<>~|!?,\{\}\[\]\\\/\s]/gi, '');
			tcode_val = decodeURIComponent(tcode_val);
	file = "Reports\\" + localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("reportname").toLowerCase()+"\\" + localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("reportname").toLowerCase()+"_"+tcode_val+".csv"
	
 $.get(decodeURIComponent(file), function(data) 
 {
	Lbl_hdr.innerText = "Tcode - " + decodeURIComponent(original_tcode_val);
	var build = '<table id="tbl_usage">\n';
	var rows = data.split("\n");
	var isRole = false;
	var i = true;
	var headerArr = []
	rows.forEach( function getvalues(thisRow) 
	{
		if(thisRow != "")
		{
		var columns = thisRow.split(",");
		if (columns[0] == "Starttime"){
			build +=" <thead> <tr>" ;
			for(var i=0;i<columns.length;i++){
				build += "<th onclick='sortTable("+i+")'>" + columns[i] + "</th>\n"; 
				headerArr.push(columns[i]);
			}		
			build +="</tr></thead>\n <tbody> ";
			i = false;
		}
		else{
			build += "<tr><td>" + columns[0] +"</td>"
			var restime=0;
			var waittime=0;
			var cputime=0;
			for(var i=1;i<columns.length;i++){
			console.log(headerArr[i])
				if(headerArr[i] == "RESPONSE_TIME(ms)")
				{
					restime=columns[i];
				}
				if(headerArr[i] == "ENQUEUE_TIME(ms)")
				{
					
					if(columns[i] > 5)
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "DB_REQ_TIME(ms)")
				{
					
					if(columns[i] > ((restime - waittime)*40/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "CPU_TIME(ms)")
				{
					cputime=columns[i];
					if(columns[i] > ((restime - waittime)*40/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "GUI_TIME(ms)")
				{
					
					if(columns[i] > 200)
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "LOAD_TIME(ms)")
				{
					
					if(columns[i] > (restime*10/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "WAIT_TIME(ms)")
				{
					waittime=columns[i];
					if(columns[i] > (restime*10/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}				
				else if(headerArr[i] == "PROCESSING_TIME(ms)")
				{
					waittime=columns[i];
					if(columns[i] > (2*cputime))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(i == 11)
				{
					console.log(columns[i])
					if(columns[i] > 220)
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else{
					build += "<td>" + columns[i] + "</td>"; 
				}
			}
			build += "</tr>\n";
		
		}
	}})
	build += "</tbody></table>";
	$("table > tr:first").css("background-color", "blue"); 
	$('#Rollview').append(build);	
	});
	makeAllSortable();

			}
		};

	xhttp.open("POST", "../cgi-bin/Tcodedetails.py",true);
	xhttp.send(fd);
}

function goBack(){
	if(localStorage.getItem("ipm_appname").toLowerCase() == "retail")
	{
		window.location.href = "IMP025.html";
	}
	else{
	window.location.href = "IMP029.html";
	}
}
 function getParamValuesByName (queryString1) {
	var qstring = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
 // console.log(qstring.length);
    for (var i = 0; i < qstring.length; i++) {
  
    var urlparam = qstring[i].split('=');
    if (urlparam[0] == queryString1) {

       return urlparam[1];
    }
  }
}	
  
var tcode_val = getParamValuesByName('tcode_val');

//file = "reports.csv";

//file = "Reports\\" + localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("reportname").toLowerCase()+"\\" + "reports.csv" 

function sortTable(table, col, reverse) {
    var tb = table, // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
        tr = Array.prototype.slice.call(tb.rows, 1), // put rows into array
        i;
    reverse = -((+reverse) || -1);
    
    tr = tr.sort(function (a, b) { // sort rows
        if(!isNaN(a.cells[col].textContent) && !isNaN(b.cells[col].textContent))
        return reverse * ((+a.cells[col].textContent) - (+b.cells[col].textContent))
       return reverse // `-1 *` if want opposite order
            * (a.cells[col].textContent.trim() // using `.textContent.trim()` for test
                .localeCompare(b.cells[col].textContent.trim())
               );
    });
    for(i = 1; i < tr.length; ++i) tb.appendChild(tr[i]); // append each row in order
}

function makeSortable(table) {
    var th = table.tHead, i;
    th && (th = th.rows[0]) && (th = th.cells);
    if (th) i = th.length;
    else return; // if no `<thead>` then do nothing
    while (--i >= 0) (function (i) {
        var dir = 1;
        th[i].addEventListener('click', function () {sortTable(table, i, (dir = 1 - dir))});
    }(i));
}

function makeAllSortable(parent) {
    parent = parent || document.body;
    var t = parent.getElementsByTagName('table'), i = t.length;
    while (--i >= 0) makeSortable(t[i]);
}

function sortTable(n) {
var xhttp = new XMLHttpRequest();	
	var fd = new FormData();
	fd.append("userid",localStorage.getItem("ipm_UserId"));
	fd.append("test_name",localStorage.getItem("reportname"));	
	fd.append("Tcode",localStorage.getItem("tcode_val"));	
	fd.append("col_no",n.toString());		
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			var response_txt = this.responseText.split("\n");
			var original_tcode_val = tcode_val;
			tcode_val = decodeURIComponent(tcode_val).replace(/[()#<>~|!?,\{\}\[\]\\\/\s]/gi, '');
			tcode_val = decodeURIComponent(tcode_val);
	file = "Reports\\" + localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("reportname").toLowerCase()+"\\" + localStorage.getItem("ipm_UserId") + "_" + localStorage.getItem("reportname").toLowerCase()+"_"+tcode_val+"_"+n+".csv"
	$("#tbl_usage").remove();
 $.get(decodeURIComponent(file), function(data) 
 {
	Lbl_hdr.innerText = "Tcode - " + decodeURIComponent(original_tcode_val);
	
	var build = '<table id="tbl_usage">\n';
	var rows = data.split("\n");
	var isRole = false;
	var i = true;
	var headerArr = []
	rows.forEach( function getvalues(thisRow) 
	{
		if(thisRow != "")
		{
		var columns = thisRow.split(",");
		if (columns[0] == "Starttime"){
			build +=" <thead> <tr>" ;
			for(var i=0;i<columns.length;i++){
				build += "<th onclick='sortTable("+i+")'>" + columns[i] + "</th>\n"; 
				headerArr.push(columns[i]);
			}		
			build +="</tr></thead>\n <tbody> ";
			i = false;
		}
		else{
			build += "<tr><td>" + columns[0] +"</td>"
			var restime=0;
			var waittime=0;
			var cputime=0;
			console.log(columns.length)
			for(var i=1;i<columns.length;i++){
				if(headerArr[i] == "RESPONSE_TIME(ms)")
				{
					restime=columns[i];
				}
				if(headerArr[i] == "ENQUEUE_TIME(ms)")
				{
					console.log(columns[i])
					if(columns[i] > 5)
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "DB_REQ_TIME(ms)")
				{
					console.log(columns[i])
					if(columns[i] > ((restime - waittime)*40/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "CPU_TIME(ms)")
				{
					cputime=columns[i];
					if(columns[i] > ((restime - waittime)*40/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "GUI_TIME(ms)")
				{
					console.log(columns[i])
					if(columns[i] > 200)
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "LOAD_TIME(ms)")
				{
					console.log(columns[i])
					if(columns[i] > (restime*10/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(headerArr[i] == "WAIT_TIME(ms)")
				{
					waittime=columns[i];
					if(columns[i] > (restime*10/100))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}				
				else if(headerArr[i] == "PROCESSING_TIME(ms)")
				{
					waittime=columns[i];
					if(columns[i] > (2*cputime))
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else if(i == 11)
				{
					console.log(columns[i])
					if(columns[i] > 220)
					{
						build += "<td style='background-color: red; color: white;'>" + columns[i] + "</td>"; 
					}
					else{
						build += "<td style='background-color: green; color: white;'>" + columns[i] + "</td>"; 
					}
				}
				else{
					build += "<td>" + columns[i] + "</td>"; 
				}
			}
			build += "</tr>\n";
		
		}
	}})
	build += "</tbody></table>";
	$("table > tr:first").css("background-color", "blue"); 
	$('#Rollview').append(build);	
	});
	makeAllSortable();

			}
		};

	xhttp.open("POST", "../cgi-bin/sort_table.py",true);
	xhttp.send(fd);
}

/*function sortTable(n) { 
	var table; 
	table = document.getElementById("tbl_usage"); 
	var rows, i, x, y, count = 0; 
	var switching = true; 

	// Order is set as ascending 
	var direction = "ascending"; 

	// Run loop until no switching is needed 
	while (switching) { 
		switching = false; 
		var rows = table.rows; 

		//Loop to go through all rows 
		for (i = 1; i < (rows.length - 1); i++) { 
			var Switch = false; 

			// Fetch 2 elements that need to be compared 
			x = rows[i].getElementsByTagName("TD")[n]; 
			y = rows[i + 1].getElementsByTagName("TD")[n]; 

			// Check the direction of order 
			if (direction == "ascending") { 

				// Check if 2 rows need to be switched 
				if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) 
					{ 
					// If yes, mark Switch as needed and break loop 
					Switch = true; 
					break; 
				} 
			} else if (direction == "descending") { 

				// Check direction 
				if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) 
					{ 
					// If yes, mark Switch as needed and break loop 
					Switch = true; 
					break; 
				} 
			} 
		} 
		if (Switch) { 
			// Function to switch rows and mark switch as completed 
			rows[i].parentNode.insertBefore(rows[i + 1], rows[i]); 
			switching = true; 

			// Increase count for each switch 
			count++; 
		} else { 
			// Run while loop again for descending order 
			if (count == 0 && direction == "ascending") { 
				direction = "descending"; 
				switching = true; 
			} 
		} 
	} 
} 

function sortTable(n) {
var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;

table = document.getElementById("tbl_usage"); 
switching = true;
dir = "asc";
while (switching) {
    switching = false;
    rows = table.getElementsByTagName("TR");
    for (i = 1; i < (rows.length - 1); i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("TD")[n];
        y = rows[i + 1].getElementsByTagName("TD")[n];
                var cmpX=isNaN(parseInt(x.innerHTML))?x.innerHTML.toLowerCase():parseInt(x.innerHTML);
                var cmpY=isNaN(parseInt(y.innerHTML))?y.innerHTML.toLowerCase():parseInt(y.innerHTML);
cmpX=(cmpX=='-')?0:cmpX;
cmpY=(cmpY=='-')?0:cmpY;
        if (dir == "asc") {
            if (cmpX > cmpY) {
                shouldSwitch= true;
                break;
            }
        } else if (dir == "desc") {
            if (cmpX < cmpY) {
                shouldSwitch= true;
                break;
            }
        }
    }
    if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        switchcount ++;      
    } else {
        if (switchcount == 0 && dir == "asc") {
            dir = "desc";
            switching = true;
        }
    }
}
}*/
</script>
<script src="../JScript/jquery.min.js"></script>
<script src="../JScript/jquery.ba-throttle-debounce.min.js"></script>

</body>
</html>