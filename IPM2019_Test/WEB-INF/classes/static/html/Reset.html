<!DOCTYPE html>
<html>
<script language="JavaScript" type="text/javascript" src="../JScript/json2.js"></script>
<script language="JavaScript" type="text/javascript" src="../JScript/jquery-1.8.3.js"></script>
<script src="../JScript/Lapam.js"></script>
<link href="../styles/bootstrap.min.css" rel="stylesheet">

<style>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>IPM</title>
    <!-- Custom Fonts -->
    <link href="../styles/landing-page.css" rel="stylesheet">
    <link href="../styles/Imperatives.css" rel="stylesheet">
    <link href="../styles/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="../styles/font-awesome/css/all.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../styles/all.css">
    <!-- jQuery -->
    <script src="../JScript/jquery.js"></script>
    <script src="../JScript/Lapam.js"></script>
    <script src="../JScript/bootstrap.min.js"></script>
    <script src="../JScript/jquery.min.js"></script>
    <link href="../styles/Main.css" rel="stylesheet">
    
<style>
	@font-face {
		font-family: 'AccentureRotis';
		src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}
	
body {
font-family: AccentureRotis;
}
	
.fieldset-checkbox {
    border-radius: 25px;
    height: auto;
    width: 750px;
    border: solid;
	margin-left:16%;
}
fieldset {
    display: block;
	margin-inline-start: 2px;
    margin-inline-end: 2px;
    padding-block-start: 0.35em;
    padding-inline-start: 0.75em;
    padding-inline-end: 0.75em;
    padding-block-end: 0.625em;
    min-inline-size: min-content;
    border-width: 2px;
    border-style: groove;
    border-color: threedface;
    border-image: initial;
}
label {
 
  font-family: AccentureRotis;
  font-size:12px;
  font-weight:bold;
}

html, body { font-family: 'AccentureRotis'; }



</style>


<body onload="usernames()">

   <div id="Div_NewQual" class="NewQual" style="background-image: url('../images/upload.png'), linear-gradient(#ffffff,#d9d9d9); background-position: center right; background-size: contain; background-repeat: no-repeat; margin-top: 10%; background-blend-mode: normal;font-family: AccentureRotis,Arial,sans-serif;">
      <fieldset id="fs_atr" class="fieldset-checkbox">
		<label class="upload_lbl" style="width: 110px;margin-left: 45%">Reset Password:</label>
		<br><br>
		<label id="lbl1" style="float: left; width: 150px;margin-left: 25%">User Name: </label>
		<select id="slt_view" name="artifactsCount"  style="margin-left: 0%" >
			
		</select>
		<br><br><br>
		<label id="lbl0" style="float: left; width: 150px;margin-left: 25%">Current Password: </label>
		<input id="curpass" type="password" name="textbox1" style=" width: 110px; float: left; top: 10px; font-family: AccentureRotis;">
		<br><br><br>
			<label id="lbl0" style="float: left; width: 150px;margin-left: 25%">New Password: </label>
		<input id="npass" type="password" name="textbox1" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" style=" width: 110px; float: left; top: 10px; font-family: AccentureRotis;" required>
		<!-- <span id = "message" style="color:red"> </span>  -->
		<br><br><br>
		<input type="checkbox" onclick="myFunction4()">Show Password
		 </fieldset>
		 <br><br><br><br>
		<button type="submit" value="Submit" id="Btn_upload" class="btn btn-primary" onclick="verifyPassword()" style="width: 80px; margin-left: 35%;">Submit</button>
		<!-- upload_files2()-->
	<br><br><br><br><br><br><br>
	
	<a type="submit" value="Submit" onclick="upload_files4()" style="width: 80px; margin-left: 85%;">Backtologin</a>
	<br><br><br><br>
	</div>

</body>


<script>



function usernames()
{
var xhttp = new XMLHttpRequest();
	var fd = new FormData();
		
	fd.append("user_name",localStorage.getItem("ipm_username"));
	xhttp.open("POST", "../cgi-bin/getLogNameForUser6.py",true);
	xhttp.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			//alert(allText);
			var opt= allText.toString().replace(/[&\/\\#+()$~%.'":*?<>{}]/g, '')
		    opt2=opt.replace(/[\[\]']+/g,'');
			var optionValues1 = opt2.split(',');
		
			var value = " ";
			optionValues = optionValues1.filter(function(item) {
			return item !== value
			})
			optionValues.splice(30, 1);
			for (var i=0;i<optionValues.length;i++){
            jQuery('#slt_view').append(jQuery("<option></option>").val(optionValues[i]).text(optionValues[i]))
			}
			jQuery('#slt_view').append(jQuery("<option disabled selected value> -- select username -- </option>"))
			}			
			};
	xhttp.send(fd);
}





function selectpattern()
{


var e = document.getElementById("slt_view");

var txtFile = new XMLHttpRequest();		
var fd = new FormData();
fd.append("user_id",localStorage.getItem("ipm_UserId"));
fd.append("Reportname",e.value);
txtFile.open("POST", "../cgi-bin/savetrade.py",true);
txtFile.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			alert(allText);
			myfunction(allText);
			}			
		};
		txtFile.send(fd);
	

}	

  function isNumber(evt) {
        var iKeyCode = (evt.which) ? evt.which : evt.keyCode
        if (iKeyCode != 46 && iKeyCode > 31 && (iKeyCode < 48 || iKeyCode > 57))
            return false;

        return true;
    }    
	
function myFunction4() {
  var x = document.getElementById("curpass");
  var y = document.getElementById("npass");
  if (x.type === "password" || y.type === "password")  {
    x.type = "text";
	y.type = "text";
  } else {
    x.type = "password";
	y.type = "password";
  }
}

function upload_files4()
{
	window.location = 'Home.html';				
}


function myfunction(res)
{

if(res.includes("not"))
{
document.getElementById("slt_view").value="";
return false;
}
}



function upload_files2()
{


var Currentpass = document.getElementById("curpass").value;
var Npass = document.getElementById("npass").value;
var username = document.getElementById("slt_view").value.trim();
var txtFile = new XMLHttpRequest();		
var fd = new FormData();
fd.append("Currentpass",Currentpass);
fd.append("Npass",Npass);
fd.append("user_name",username);
txtFile.open("POST", "../cgi-bin/getLogNameForUser8.py",true);
txtFile.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			alert(allText);
			}			
		};
		txtFile.send(fd);

}

function verifyPassword() {
	if(document.getElementById("curpass").value == "" || document.getElementById("npass").value == "" || document.getElementById("slt_view").value == "")
	{
	alert("Values should be filled and select user from drop menu");
	return false;
	}

  var pw = document.getElementById("npass").value;   
  
   
  if(!(/[A-Z]/.test(pw) && /[0-9]/.test(pw) && /(?=.*[-+_!@#$%^&*., ?])/.test(pw) && pw.length >= 8 && pw.length <= 15))
  {
     alert ('Password size should be greater than 8 ! it must contain atleast one uppercase, number and special charecter');
	 return false;
        }
  else {  
     alert("Password is strong enough to proceed");  
	 upload_files2();
  }  
}  

function upload_files()
{



//var min= document.getElementById("time").value * 60;
var tim= document.getElementById("time").value
var values = Array.from(document.getElementById("slt_view1").options).map(e => e.value);
console.log(values);
const result = values.includes(document.getElementById("Repname").value);

if(!result)
{
var nreport= document.getElementById("Repname").value
var selevalue= document.getElementById("slt_view").value;
var y=selevalue.trim();
var txtFile = new XMLHttpRequest();		
var fd = new FormData();
fd.append("user_id",localStorage.getItem("ipm_UserId"));
fd.append("NReportname",nreport);
localStorage.setItem("nreport",nreport);
fd.append("OReportname",y);
fd.append("resp_time",tim);
txtFile.open("POST", "../cgi-bin/murex_osp_time_log.py",true);
txtFile.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			//alert(allText);
			myfunction1();
			}			
		};
		txtFile.send(fd);
}
else{
alert("Reportname already exists")
document.getElementById("Repname").value ="";
return false;
}
}


function myfunction1()
{
var txtFile = new XMLHttpRequest();		
var fd = new FormData();
fd.append("username","murex");
fd.append("user_id",localStorage.getItem("ipm_UserId"));
var Txt_reportname=localStorage.getItem("nreport");
fd.append("Txt_reportname",localStorage.getItem("nreport"));
txtFile.open("POST", "../cgi-bin/upload1.py",true);
txtFile.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			alert(allText);
			}			
		};
		txtFile.send(fd);

}

</script>
</html>