<!DOCTYPE html>
<html>
<script language="JavaScript" type="text/javascript" src="../JScript/json2.js"></script>
<script language="JavaScript" type="text/javascript" src="../JScript/jquery-1.8.3.js"></script>

<style>

@font-face {
		font-family: 'AccentureRotis';
		src: url('../styles/rotsan.woff') format('woff'); /* Modern Browsers */
	}
	
body {
font-family: AccentureRotis;
}
	
input[type=text] {
  width: 100%;
  height: 50%;
  padding: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
  resize: vertical;
}

label {
  padding: 12px 12px 12px 0;
  display: inline-block;
  font-family: AccentureRotis;
}

input[type=button] {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 6px 20px;
  text-decoration: none;
  margin: 4px 2px;
  cursor: pointer;
}

</style>
<body>
<div>
  <div style="width: 50%;float:left">
  <fieldset id="fs_atr1" class="fieldset-checkbox" style="display: block; width: 5px;">
  <legend class="fs_legend"> File upload </legend>
  <div id="Div_Addditional1" style="overflow-y: auto; width: 500px; margin-left: 5px; padding-left: 5px;">
  <label id="lbl0" style="float: left; width: 150px;">Trade Insertion : </label>
  <input id="Tradeint" type="file" name="file" style="margin-left: 10px; float: left; top: 10px; font-family: AccentureRotis;">
   <label class="upload_lbl" style="float: left; font-size: 11px;">(supported file types: .xml(only xml)</label>
  <a style="text-decoration:underline; cursor: pointer;" onclick="document.getElementById('Tradeint').value=null">Remove</a><br></div>
 
  
  <br><br>
  
  <button type="submit" value="Upload" id="Btn_upload" class="btn btn-primary" onclick="upload_files()" style="width: 100px; margin-left: 140px; font-family: AccentureRotis;">Upload</button>
  
  </fieldset>
<br><br>
	<textarea id="txt1" name="txt" rows="20" cols="70" style= "margin-left: 4px;" readonly></textarea>
</div>

<div id ="tab" style="width: 50%;float:right;">

  <label class="list-heading1" id="CompareTest_lbl1">Enter header and headerpath values</label></br>
  
    <label>Header</label><input type='textbox' id="myInput1" name='Header' />
   
	 <label>HeaderPath</label><input type='textbox' id="myInput2" name='HeaderPath' style="width:40%" /><br>
	


<br><br>
<button type="submit" value="Upload" id="Btn_upload2" class="btn btn-primary"   style="width: 100px; margin-left: 140px; font-family: AccentureRotis;">Validate</button>


</div>
</div>
</body>




<script>

function upload_files()
{

fileExtension = document.getElementById("Tradeint").value.substring(document.getElementById("Tradeint").value.lastIndexOf(".") + 1, document.getElementById("Tradeint").value.length);


if (fileExtension.toLowerCase() == "xml")
{

var file = document.getElementById("Tradeint").files[0];
var reader = new FileReader();
reader.onload = function (e) {
    var textArea = document.getElementById("txt1");
    textArea.value = e.target.result;
	var fileInput = document.getElementById('Tradeint');   
	var filename = fileInput.files[0].name;
	localStorage.setItem("Fname",filename);
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("values",e.target.result);
	fd.append("filename",filename);
	
	txtFile.open("POST", "../cgi-bin/savexml.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;	
			}			
		};
		txtFile.send(fd);
};
reader.readAsText(file);
alert("File uploaded...");
return true;
}
else
{
alert("Kindly select a valid file for upload");
document.getElementById('Tradeint').value=null;
return false; 
}

}

  

$('#Btn_upload2').click(function() {

if($('#myInput1').val() == "" || $('#myInput2').val() == "")
{
$('#myInput1').focus();
alert("First Header & HeaderURL Should not be Empty!");
return false;
}

	const key = $('#myInput1').val(); 
	
	const object = {   
        [key]:$('#myInput2').val()

    };
 
    var json_text = JSON.stringify(object, null, 2);
	console.log(json_text);
	
	var txtFile = new XMLHttpRequest();		
	var fd = new FormData();
	fd.append("filename",localStorage.getItem("Fname"));
	fd.append("user_id",localStorage.getItem("ipm_UserId"));
	fd.append("headerjson",json_text);
	txtFile.open("POST", "../cgi-bin/murex_validation.py",true);
	txtFile.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200)
			{
			allText = this.responseText;
			alert(allText);
			}			
		};
		txtFile.send(fd);
	
});

</script>
</html>